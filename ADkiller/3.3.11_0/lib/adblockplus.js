require.scopes.prefs=function(){var t={},e={__proto__:null,enabled:!0,data_directory:"",patternsbackups:5,patternsbackupinterval:24,savestats:!1,privateBrowsing:!1,subscriptions_fallbackerrors:5,subscriptions_fallbackurl:"https://adblockplus.org/getSubscription?version=%VERSION%&url=%SUBSCRIPTION%&downloadURL=%URL%&error=%ERROR%&channelStatus=%CHANNELSTATUS%&responseStatus=%RESPONSESTATUS%",subscriptions_autoupdate:!0,subscriptions_videoblockurl:"http://sub.adtchrome.com/adt-videolist.txt",documentation_link:"https://adblockplus.org/redirect?link=%LINK%&lang=%LANG%",notificationdata:{},notificationurl:"http://sub.adtchrome.com/updateSubscription.json",guidePageData:{},guidePageUrl:"http://sub.adtchrome.com/guidePage.json",stats_total:{}},i=[];function r(t){var r=null;n.__defineGetter__(t,(function(){if(null===r){if(t in localStorage)try{r=JSON.parse(localStorage[t])}catch(t){Cu.reportError(t)}null===r&&(r=JSON.parse(JSON.stringify(e[t])))}return r})),n.__defineSetter__(t,(function(n){if(typeof n!=typeof e[t])throw new Error("Attempt to change preference type");var s=JSON.stringify(n);s!=JSON.stringify(e[t])?localStorage[t]=s:delete localStorage[t],r=n;for(var o=0;o<i.length;++o){(0,i[o])(t)}return r}))}var n=t.Prefs={addListener:function(t){i.indexOf(t)<0&&i.push(t)},removeListener:function(t){var e=i.indexOf(t);e>=0&&i.splice(e,1)}};for(var s in e)r(s);return t}(),require.scopes.utils=function(){var t,e={},i=e.Utils={systemPrincipal:null,getString:function(t){return t},runAsync:function(e){if(e=e.bind.apply(e,Array.prototype.slice.call(arguments,1)),void 0===t&&(t="loading"==document.readyState?[]:null)){var i=function(){document.removeEventListener("DOMContentLoaded",i,!1);var e=t;t=null;for(var r=0;r<e.length;++r){var n=e[r];try{n()}catch(t){Cu.reportError(t)}}};document.addEventListener("DOMContentLoaded",i,!1)}t?t.push(e):window.setTimeout(e,0)},get appLocale(){var t=chrome.i18n.getMessage("@@ui_locale").replace(/_/g,"-");return this.__defineGetter__("appLocale",(function(){return t})),this.appLocale},generateChecksum:function(t){return null},makeURI:function(t){return Services.io.newURI(t)},getDocLink:function(t){return require("prefs").Prefs.documentation_link.replace(/%LINK%/g,t).replace(/%LANG%/g,i.appLocale)}};return e}(),require.scopes.elemHideHitRegistration=function(){var t={};t.AboutHandler={};return t}(),require.scopes.downloader=function(){var t={},e=require("utils").Utils,i=t.MILLIS_IN_SECOND=1e3,r=t.MILLIS_IN_MINUTE=60*i,n=t.MILLIS_IN_HOUR=60*r,s=t.MILLIS_IN_DAY=24*n;return(t.Downloader=function(t,e,i){this.dataSource=t,this._timer=Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer),this._timer.initWithCallback(function(){this._timer.delay=i,this._doCheck()}.bind(this),e,Ci.nsITimer.TYPE_REPEATING_SLACK),this._downloading=Object.create(null)}).prototype={_timer:null,_downloading:null,dataSource:null,maxAbsenseInterval:1*s,minRetryInterval:1*s,maxExpirationInterval:14*s,maxRedirects:5,onExpirationChange:null,onDownloadStarted:null,onDownloadSuccess:null,onDownloadError:null,_doCheck:function(){for(var t=Date.now(),e=0;e<this.dataSource().length;++e){var i=this.dataSource()[e];i.lastCheck&&t-i.lastCheck>this.maxAbsenseInterval&&(i.softExpiration+=t-i.lastCheck),i.lastCheck=t,i.hardExpiration-t>this.maxExpirationInterval&&(i.hardExpiration=t+this.maxExpirationInterval),i.softExpiration-t>this.maxExpirationInterval&&(i.softExpiration=t+this.maxExpirationInterval),this.onExpirationChange&&this.onExpirationChange(i),i.softExpiration>t&&i.hardExpiration>t||(i.lastError&&t-i.lastError<this.minRetryInterval||this._download(i,0))}},cancel:function(){this._timer.cancel()},isDownloading:function(t){return t in this._downloading},download:function(t){e.runAsync(this._download.bind(this,t,0))},getDownloadUrl:function(t){var e=require("info"),i=e.addonName,r=e.addonVersion,n=e.application,s=e.applicationVersion,o=e.platform,a=e.platformVersion,l=t.redirectURL||t.url;return l.indexOf("?")>=0?l+="&":l+="?",l+="addonName="+encodeURIComponent(i)+"&addonVersion="+encodeURIComponent(r)+"&application="+encodeURIComponent(n)+"&applicationVersion="+encodeURIComponent(s)+"&platform="+encodeURIComponent(o)+"&platformVersion="+encodeURIComponent(a)+"&lastVersion="+encodeURIComponent(t.lastVersion)+"&t="+Date.now()},_download:function(t,e){if(!(t.url in this._downloading)){var i=this.getDownloadUrl(t),r=null,n=function(n){var s=-1;try{s=r.channel.status}catch(t){}var o=r.status;if(Cu.reportError("Adblock Plus: Downloading URL "+t.url+" failed ("+n+")\nDownload address: "+i+"\nChannel status: "+s+"\nServer response: "+o),this.onDownloadError){var a=null;e<=this.maxRedirects&&(a=function(i){t.redirectURL=i,this._download(t,e+1)}.bind(this)),this.onDownloadError(t,i,n,s,o,a)}}.bind(this);try{(r=new XMLHttpRequest).mozBackgroundRequest=!0,r.open("GET",i)}catch(t){return void n("synchronize_invalid_url")}try{r.overrideMimeType("text/plain"),r.channel.loadFlags=r.channel.loadFlags|r.channel.INHIBIT_CACHING|r.channel.VALIDATE_ALWAYS,r.channel instanceof Ci.nsIHttpChannel&&(r.channel.redirectionLimit=this.maxRedirects)}catch(t){Cu.reportError(t)}r.addEventListener("error",function(e){onShutdown.done||(delete this._downloading[t.url],n("synchronize_connection_error"))}.bind(this),!1),r.addEventListener("load",function(i){onShutdown.done||(delete this._downloading[t.url],r.status&&200!=r.status?n("synchronize_connection_error"):this.onDownloadSuccess(t,r.responseText,n,function(i){e>=this.maxRedirects?n("synchronize_connection_error"):(t.redirectURL=i,this._download(t,e+1))}.bind(this)))}.bind(this),!1),this._downloading[t.url]=!0,this.onDownloadStarted&&this.onDownloadStarted(t),r.send(null)}},processExpirationInterval:function(t){t=Math.min(Math.max(t,0),this.maxExpirationInterval);var e=Math.round(t*(.4*Math.random()+.8)),i=2*t,r=Date.now();return[r+e,r+i]}},(t.Downloadable=function(t){this.url=t}).prototype={url:null,redirectURL:null,lastError:0,lastCheck:0,lastVersion:0,softExpiration:0,hardExpiration:0},t}(),require.scopes.filterNotifier=function(){var t={},e=[];t.FilterNotifier={addListener:function(t){e.indexOf(t)>=0||e.push(t)},removeListener:function(t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},triggerListeners:function(t,i,r,n,s){for(var o=0;o<e.length;++o){(0,e[o])(t,i,r,n,s)}}};return t}(),require.scopes.filterClasses=function(){var t={},e=require("filterNotifier").FilterNotifier;function i(t){this.text=t,this.subscriptions=[]}function r(t,e){i.call(this,t),this.reason=e}function n(t){i.call(this,t)}function s(t,e){i.call(this,t),this.domainSource=e}function o(t,e,i,r,n,o){if(s.call(this,t,n),null!=i&&(this.contentType=i),r&&(this.matchCase=r),null!=o&&(this.thirdParty=o),e.length>=2&&"/"==e[0]&&"/"==e[e.length-1]){var a=new RegExp(e.substr(1,e.length-2),this.matchCase?"":"i");this.__defineGetter__("regexp",(function(){return a}))}else this.regexpSource=e}function a(t,e,i,r,n,s,a){o.call(this,t,e,i,r,n,s),this.collapse=a}function l(t,e,i,r,n,s,a,l,u){o.call(this,t,e,i,r,n,s),this.collapse=a,this.replace=l,this.keyword=u,this.redirect=function(t){return t.replace(this.regexp,l)}}function u(t,e,i,r,n,s,a){o.call(this,t,e,i,r,n,s),null!=a&&(this.siteKeys=a)}function c(t,e,i){s.call(this,t,e?e.toUpperCase():null),e&&(this.selectorDomain=e.replace(/,~[^,]+/g,"").replace(/^~[^,]+,?/,"").toLowerCase()),this.selector=i}function d(t,e,i){c.call(this,t,e,i)}function p(t,e,i){c.call(this,t,e,i)}return t.Filter=i,i.prototype={text:null,subscriptions:null,serialize:function(t){t.push("[Filter]"),t.push("text="+this.text)},toString:function(){return this.text}},i.knownFilters={__proto__:null},i.elemhideRegExp=/^([^\/\*\|\@"!]*?)#(\@)?(?:([\w\-]+|\*)((?:\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\))*)|#([^{}]+))$/,i.regexpRegExp=/^(@@)?\/.*\/(?:\$~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)?$/,i.optionsRegExp=/\$(~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)$/,i.fromText=function(t){if(t in i.knownFilters)return i.knownFilters[t];var e,r=t.indexOf("#")>=0?i.elemhideRegExp.exec(t):null;return e=r?c.fromText(t,r[1],r[2],r[3],r[4],r[5]):"!"==t[0]?new n(t):o.fromText(t),i.knownFilters[e.text]=e,e},i.fromObject=function(t){var e=i.fromText(t.text);return e instanceof s&&("disabled"in t&&(e._disabled="true"==t.disabled),"hitCount"in t&&(e._hitCount=parseInt(t.hitCount)||0),"lastHit"in t&&(e._lastHit=parseInt(t.lastHit)||0)),e},i.normalize=function(t){if(!t)return t;if(t=t.replace(/[^\S ]/g,""),/^\s*!/.test(t))return t.replace(/^\s+/,"").replace(/\s+$/,"");if(i.elemhideRegExp.test(t)){var e=/^(.*?)(#\@?#?)(.*)$/.exec(t),r=e[1],n=e[2],s=e[3];return r.replace(/\s/g,"")+n+s.replace(/^\s+/,"").replace(/\s+$/,"")}return t.replace(/\s/g,"")},t.InvalidFilter=r,r.prototype={__proto__:i.prototype,reason:null,serialize:function(t){}},t.CommentFilter=n,n.prototype={__proto__:i.prototype,serialize:function(t){}},t.ActiveFilter=s,s.prototype={__proto__:i.prototype,_disabled:!1,_hitCount:0,_lastHit:0,get disabled(){return this._disabled},set disabled(t){if(t!=this._disabled){var i=this._disabled;this._disabled=t,e.triggerListeners("filter.disabled",this,t,i)}return this._disabled},get hitCount(){return this._hitCount},set hitCount(t){if(t!=this._hitCount){var i=this._hitCount;this._hitCount=t,e.triggerListeners("filter.hitCount",this,t,i)}return this._hitCount},get lastHit(){return this._lastHit},set lastHit(t){if(t!=this._lastHit){var i=this._lastHit;this._lastHit=t,e.triggerListeners("filter.lastHit",this,t,i)}return this._lastHit},domainSource:null,domainSeparator:null,ignoreTrailingDot:!0,get domains(){var t=null;if(this.domainSource){var e=this.domainSource.split(this.domainSeparator);if(1==e.length&&"~"!=e[0][0])t={__proto__:null,"":!1},this.ignoreTrailingDot&&(e[0]=e[0].replace(/\.+$/,"")),t[e[0]]=!0;else{for(var i=!1,r=0;r<e.length;r++){var n,s=e[r];if(this.ignoreTrailingDot&&(s=s.replace(/\.+$/,"")),""!=s)"~"==s[0]?(n=!1,s=s.substr(1)):(n=!0,i=!0),t||(t={__proto__:null}),t[s]=n}t[""]=!i}delete this.domainSource}return this.__defineGetter__("domains",(function(){return t})),this.domains},isActiveOnDomain:function(t){if(!this.domains)return!0;if(!t)return this.domains[""];for(this.ignoreTrailingDot&&(t=t.replace(/\.+$/,"")),t=t.toUpperCase();;){if(t in this.domains)return this.domains[t];var e=t.indexOf(".");if(e<0)break;t=t.substr(e+1)}return this.domains[""]},isActiveOnlyOnDomain:function(t){if(!t||!this.domains||this.domains[""])return!1;for(var e in this.ignoreTrailingDot&&(t=t.replace(/\.+$/,"")),t=t.toUpperCase(),this.domains)if(this.domains[e]&&e!=t&&(e.length<=t.length||e.indexOf("."+t)!=e.length-t.length-1))return!1;return!0},serialize:function(t){(this._disabled||this._hitCount||this._lastHit)&&(i.prototype.serialize.call(this,t),this._disabled&&t.push("disabled=true"),this._hitCount&&t.push("hitCount="+this._hitCount),this._lastHit&&t.push("lastHit="+this._lastHit))}},t.RegExpFilter=o,o.prototype={__proto__:s.prototype,length:1,domainSeparator:"|",regexpSource:null,get regexp(){var t=this.regexpSource.replace(/\*+/g,"*");"*"==t[0]&&(t=t.substr(1));var e=t.length-1;e>=0&&"*"==t[e]&&(t=t.substr(0,e)),t=t.replace(/\^\|$/,"^").replace(/\W/g,"\\$&").replace(/\\\*/g,".*").replace(/\\\^/g,"(?:[\\x00-\\x24\\x26-\\x2C\\x2F\\x3A-\\x40\\x5B-\\x5E\\x60\\x7B-\\x80]|$)").replace(/^\\\|\\\|/,"^[\\w\\-]+:\\/+(?!\\/)(?:[^.\\/]+\\.)*?").replace(/^\\\|/,"^").replace(/\\\|$/,"$");var i=new RegExp(t,this.matchCase?"":"i");return delete this.regexpSource,this.__defineGetter__("regexp",(function(){return i})),this.regexp},contentType:2147483647,matchCase:!1,thirdParty:null,matches:function(t,e,i,r){return!(!this.regexp.test(t)||0==(o.typeMap[e]&this.contentType)||null!=this.thirdParty&&this.thirdParty!=r||!this.isActiveOnDomain(i))}},o.prototype.__defineGetter__("0",(function(){return this})),o.fromText=function(t){var e=!0,n=t;0==t.indexOf("@@")&&(e=!1,t=t.substr(2));var s,c=null,d=null,p=null,h=null,f=null,_=null,g=t.indexOf(">>>");if(g>=0){var v=n.substring(0,g),b=t.indexOf(">>>>"),w=n.substring(g+3,b),m=n.substring(b+4).split(",");return new l(n,v,c,d,p,f,_,w,m[0].split("=")[1])}var S=t.indexOf("$")>=0?i.optionsRegExp.exec(t):null;if(S){s=S[1].toUpperCase().split(","),t=S.input.substr(0,S.index);for(var x=0;x<s.length;++x){var y=s[x],E=null,C=y.indexOf("=");if(C>=0&&(E=y.substr(C+1),y=y.substr(0,C)),(y=y.replace(/-/,"_"))in o.typeMap)null==c&&(c=0),c|=o.typeMap[y];else if("~"==y[0]&&y.substr(1)in o.typeMap)null==c&&(c=o.prototype.contentType),c&=~o.typeMap[y.substr(1)];else if("MATCH_CASE"==y)d=!0;else if("~MATCH_CASE"==y)d=!1;else if("DOMAIN"==y&&void 0!==E)p=E;else if("THIRD_PARTY"==y)f=!0;else if("~THIRD_PARTY"==y)f=!1;else if("COLLAPSE"==y)_=!0;else if("~COLLAPSE"==y)_=!1;else{if("SITEKEY"!=y||void 0===E)return new r(n,"Unknown option "+y.toLowerCase());h=E.split(/\|/)}}}e||!(null==c||c&o.typeMap.DOCUMENT)||s&&!(s.indexOf("DOCUMENT")<0)||/^\|?[\w\-]+:/.test(t)||(null==c&&(c=o.prototype.contentType),c&=~o.typeMap.DOCUMENT),!e&&h&&(c=o.typeMap.DOCUMENT);try{return e?new a(n,t,c,d,p,f,_):new u(n,t,c,d,p,f,h)}catch(t){return new r(n,t)}},o.typeMap={OTHER:1,SCRIPT:2,IMAGE:4,STYLESHEET:8,OBJECT:16,SUBDOCUMENT:32,DOCUMENT:64,XBL:1,PING:1,XMLHTTPREQUEST:2048,OBJECT_SUBREQUEST:4096,DTD:1,MEDIA:16384,FONT:32768,BACKGROUND:4,POPUP:268435456,ELEMHIDE:1073741824},o.prototype.contentType&=~(o.typeMap.ELEMHIDE|o.typeMap.POPUP),t.BlockingFilter=a,a.prototype={__proto__:o.prototype,collapse:null},t.RedirectFilter=l,l.prototype={__proto__:o.prototype,collapse:null,replace:null},t.WhitelistFilter=u,u.prototype={__proto__:o.prototype,siteKeys:null},t.ElemHideBase=c,c.prototype={__proto__:s.prototype,domainSeparator:",",ignoreTrailingDot:!1,selectorDomain:null,selector:null},c.fromText=function(t,e,i,n,s,o){if(!o){"*"==n&&(n="");var a=null,l="";if(s){s=s.match(/\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\)/g);for(var u=0;u<s.length;++u){var c=s[u];if((c=c.substr(1,c.length-2)).indexOf("=")>0)l+="["+(c=c.replace(/=/,'="')+'"')+"]";else{if(a)return new r(t,require("utils").Utils.getString("filter_elemhide_duplicate_id"));a=c}}}if(a)o=n+"."+a+l+","+n+"#"+a+l;else{if(!n&&!l)return new r(t,require("utils").Utils.getString("filter_elemhide_nocriteria"));o=n+l}}return i?new p(t,e,o):new d(t,e,o)},t.ElemHideFilter=d,d.prototype={__proto__:c.prototype},t.ElemHideException=p,p.prototype={__proto__:c.prototype},t}(),require.scopes.subscriptionClasses=function(){var t={},e=require("filterClasses"),i=e.ActiveFilter,r=e.BlockingFilter,n=e.WhitelistFilter,s=e.ElemHideBase,o=require("filterNotifier").FilterNotifier;function a(t,e){if(this.url=t,this.filters=[],e)this._title=e;else{var i=require("utils").Utils;this._title=i.getString("newGroup_title")}a.knownSubscriptions[t]=this}function l(t,e){a.call(this,t,e)}function u(t,e){a.call(this,t,e||t)}function c(t,e){u.call(this,t,e)}function d(t,e){u.call(this,t,e)}return t.Subscription=a,a.prototype={url:null,filters:null,_title:null,_fixedTitle:!1,_disabled:!1,get title(){return this._title},set title(t){if(t!=this._title){var e=this._title;this._title=t,o.triggerListeners("subscription.title",this,t,e)}return this._title},get fixedTitle(){return this._fixedTitle},set fixedTitle(t){if(t!=this._fixedTitle){var e=this._fixedTitle;this._fixedTitle=t,o.triggerListeners("subscription.fixedTitle",this,t,e)}return this._fixedTitle},get disabled(){return this._disabled},set disabled(t){if(t!=this._disabled){var e=this._disabled;this._disabled=t,o.triggerListeners("subscription.disabled",this,t,e)}return this._disabled},serialize:function(t){t.push("[Subscription]"),t.push("url="+this.url),t.push("title="+this._title),this._fixedTitle&&t.push("fixedTitle=true"),this._disabled&&t.push("disabled=true")},serializeFilters:function(t){for(var e=0;e<this.filters.length;++e){var i=this.filters[e];t.push(i.text.replace(/\[/g,"\\["))}},toString:function(){var t=[];return this.serialize(t),t.join("\n")}},a.knownSubscriptions={__proto__:null},a.fromURL=function(t){if(t in a.knownSubscriptions)return a.knownSubscriptions[t];try{return new d(t=Services.io.newURI(t,null,null).spec,null)}catch(e){return new l(t)}},a.fromObject=function(t){var e;try{if(t.url=Services.io.newURI(t.url,null,null).spec,e=new d(t.url,t.title),"downloadStatus"in t&&(e._downloadStatus=t.downloadStatus),"lastSuccess"in t&&(e.lastSuccess=parseInt(t.lastSuccess)||0),"lastCheck"in t&&(e._lastCheck=parseInt(t.lastCheck)||0),"expires"in t&&(e.expires=parseInt(t.expires)||0),"softExpiration"in t&&(e.softExpiration=parseInt(t.softExpiration)||0),"errors"in t&&(e._errors=parseInt(t.errors)||0),"version"in t&&(e.version=parseInt(t.version)||0),"requiredVersion"in t){var i=require("info").addonVersion;e.requiredVersion=t.requiredVersion,Services.vc.compare(e.requiredVersion,i)>0&&(e.upgradeRequired=!0)}"homepage"in t&&(e._homepage=t.homepage),"lastDownload"in t&&(e._lastDownload=parseInt(t.lastDownload)||0)}catch(i){if(!("title"in t)&&("~wl~"==t.url?t.defaults="whitelist":"~fl~"==t.url?t.defaults="blocking":"~eh~"==t.url&&(t.defaults="elemhide"),"defaults"in t)){var r=require("utils").Utils;t.title=r.getString(t.defaults+"Group_title")}e=new l(t.url,t.title),"defaults"in t&&(e.defaults=t.defaults.split(" "))}return"fixedTitle"in t&&(e._fixedTitle="true"==t.fixedTitle),"disabled"in t&&(e._disabled="true"==t.disabled),e},t.SpecialSubscription=l,l.prototype={__proto__:a.prototype,defaults:null,isDefaultFor:function(t){if(this.defaults&&this.defaults.length)for(var e=0;e<this.defaults.length;++e){var r=this.defaults[e];if(t instanceof l.defaultsMap[r])return!0;if(!(t instanceof i)&&"blacklist"==r)return!0}return!1},serialize:function(t){a.prototype.serialize.call(this,t),this.defaults&&this.defaults.length&&t.push("defaults="+this.defaults.filter((function(t){return t in l.defaultsMap})).join(" ")),this._lastDownload&&t.push("lastDownload="+this._lastDownload)}},l.defaultsMap={__proto__:null,whitelist:n,blocking:r,elemhide:s},l.create=function(t){var e;do{e="~user~"+Math.round(1e6*Math.random())}while(e in a.knownSubscriptions);return new l(e,t)},l.createForFilter=function(t){var e=l.create();for(var i in e.filters.push(t),l.defaultsMap)t instanceof l.defaultsMap[i]&&(e.defaults=[i]);e.defaults||(e.defaults=["blocking"]);var r=require("utils").Utils;return e.title=r.getString(e.defaults[0]+"Group_title"),e},t.RegularSubscription=u,u.prototype={__proto__:a.prototype,_homepage:null,_lastDownload:0,get homepage(){return this._homepage},set homepage(t){if(t!=this._homepage){var e=this._homepage;this._homepage=t,o.triggerListeners("subscription.homepage",this,t,e)}return this._homepage},get lastDownload(){return this._lastDownload},set lastDownload(t){if(t!=this._lastDownload){var e=this._lastDownload;this._lastDownload=t,o.triggerListeners("subscription.lastDownload",this,t,e)}return this._lastDownload},serialize:function(t){a.prototype.serialize.call(this,t),this._homepage&&t.push("homepage="+this._homepage),this._lastDownload&&t.push("lastDownload="+this._lastDownload)}},t.ExternalSubscription=c,c.prototype={__proto__:u.prototype,serialize:function(t){throw new Error("Unexpected call, external subscriptions should not be serialized")}},t.DownloadableSubscription=d,d.prototype={__proto__:u.prototype,_downloadStatus:null,_lastCheck:0,_errors:0,get downloadStatus(){return this._downloadStatus},set downloadStatus(t){var e=this._downloadStatus;return this._downloadStatus=t,o.triggerListeners("subscription.downloadStatus",this,t,e),this._downloadStatus},lastSuccess:0,get lastCheck(){return this._lastCheck},set lastCheck(t){if(t!=this._lastCheck){var e=this._lastCheck;this._lastCheck=t,o.triggerListeners("subscription.lastCheck",this,t,e)}return this._lastCheck},expires:0,softExpiration:0,get errors(){return this._errors},set errors(t){if(t!=this._errors){var e=this._errors;this._errors=t,o.triggerListeners("subscription.errors",this,t,e)}return this._errors},version:0,requiredVersion:null,upgradeRequired:!1,serialize:function(t){u.prototype.serialize.call(this,t),this.downloadStatus&&t.push("downloadStatus="+this.downloadStatus),this.lastSuccess&&t.push("lastSuccess="+this.lastSuccess),this.lastCheck&&t.push("lastCheck="+this.lastCheck),this.expires&&t.push("expires="+this.expires),this.softExpiration&&t.push("softExpiration="+this.softExpiration),this.errors&&t.push("errors="+this.errors),this.version&&t.push("version="+this.version),this.requiredVersion&&t.push("requiredVersion="+this.requiredVersion)}},t}(),require.scopes.filterStorage=function(){var t={},e=require("io").IO,i=require("prefs").Prefs,r=require("filterClasses"),n=r.Filter,s=r.ActiveFilter,o=require("subscriptionClasses"),a=o.Subscription,l=o.SpecialSubscription,u=o.ExternalSubscription,c=require("filterNotifier").FilterNotifier,d=t.FilterStorage={get formatVersion(){return 4},get sourceFile(){var t=null;if(i.patternsfile&&(t=e.resolveFilePath(i.patternsfile)),t||(t=e.resolveFilePath(i.data_directory))&&t.append("patterns.ini"),!t)try{(t=e.resolveFilePath(Services.prefs.getDefaultBranch("extensions.adblockplus.").getCharPref("data_directory")))&&t.append("patterns.ini")}catch(t){}return t||Cu.reportError("Adblock Plus: Failed to resolve filter file location from extensions.adblockplus.patternsfile preference"),this.__defineGetter__("sourceFile",(function(){return t})),this.sourceFile},fileProperties:{__proto__:null},subscriptions:[],knownSubscriptions:{__proto__:null},getGroupForFilter:function(t){for(var e=null,i=0;i<d.subscriptions.length;++i){var r=d.subscriptions[i];if(r instanceof l&&!r.disabled){if(r.isDefaultFor(t))return r;e||r.defaults&&r.defaults.length||(e=r)}}return e},addSubscription:function(t,e){t.url in d.knownSubscriptions||(d.subscriptions.push(t),d.knownSubscriptions[t.url]=t,p(t),e||c.triggerListeners("subscription.added",t))},removeSubscription:function(t,e){for(var i=0;i<d.subscriptions.length;i++)if(d.subscriptions[i].url==t.url)return h(t),d.subscriptions.splice(i--,1),delete d.knownSubscriptions[t.url],void(e||c.triggerListeners("subscription.removed",t))},moveSubscription:function(t,e){var i=d.subscriptions.indexOf(t);if(!(i<0)){var r=e?d.subscriptions.indexOf(e):-1;r<0&&(r=d.subscriptions.length),i<r&&r--,i!=r&&(d.subscriptions.splice(i,1),d.subscriptions.splice(r,0,t),c.triggerListeners("subscription.moved",t))}},updateSubscriptionFilters:function(t,e){h(t),t.oldFilters=t.filters,t.filters=e,p(t),c.triggerListeners("subscription.updated",t),delete t.oldFilters},addFilter:function(t,e,i,r){if(!e){if(t.subscriptions.some((function(t){return t instanceof l&&!t.disabled})))return;e=d.getGroupForFilter(t)}if(!e)return e=l.createForFilter(t),void this.addSubscription(e);void 0===i&&(i=e.filters.length),t.subscriptions.indexOf(e)<0&&t.subscriptions.push(e),e.filters.splice(i,0,t),r||c.triggerListeners("filter.added",t,e,i)},removeFilter:function(t,e,i){for(var r=e?[e]:t.subscriptions.slice(),n=0;n<r.length;n++){if((e=r[n])instanceof l){var s=[];if(void 0===i){var o=-1;do{(o=e.filters.indexOf(t,o+1))>=0&&s.push(o)}while(o>=0)}else s.push(i);for(var a=s.length-1;a>=0;a--){i=s[a];if(e.filters[i]==t){if(e.filters.splice(i,1),e.filters.indexOf(t)<0)(o=t.subscriptions.indexOf(e))>=0&&t.subscriptions.splice(o,1);c.triggerListeners("filter.removed",t,e,i)}}}}},moveFilter:function(t,e,i,r){e instanceof l&&e.filters[i]==t&&i!=(r=Math.min(Math.max(r,0),e.filters.length-1))&&(e.filters.splice(i,1),e.filters.splice(r,0,t),c.triggerListeners("filter.moved",t,e,i,r))},increaseHitCount:function(t,e){i.savestats&&!f.enabledForWindow(e)&&!f.enabled&&t instanceof s&&(t.hitCount++,t.lastHit=Date.now())},resetHitCounts:function(t){if(!t)for(var e in t=[],n.knownFilters)t.push(n.knownFilters[e]);for(var i=0;i<t.length;++i){var r=t[i];r.hitCount=0,r.lastHit=0}},_loading:!1,loadFromDisk:function(t){if(!this._loading){var i,r=function(t,n){var o=new _;e.readFromFile(t,!0,o,function(a){if(a||0!=o.subscriptions.length||(a=new Error("No data in the file")),a&&Cu.reportError(a),a&&!i&&(t=this.sourceFile)){var l=/^(.*)(\.\w+)$/.exec(t.leafName)||[null,t.leafName,""],u=l[1],c=l[2];return(t=t.clone()).leafName=u+"-backup"+ ++n+c,void e.statFile(t,(function(e,i){!e&&i.exists?r(t,n):s(o)}))}s(o)}.bind(this),"FilterStorageRead")}.bind(this),s=function(e){for(var i={"~il~":!0,"~wl~":!0,"~fl~":!0,"~eh~":!0},r={__proto__:null},s=0;s<e.subscriptions.length;s++){var o=e.subscriptions[s];o instanceof l&&0==o.filters.length&&o.url in i?e.subscriptions.splice(s--,1):r[o.url]=o}if(this.fileProperties=e.fileProperties,this.subscriptions=e.subscriptions,this.knownSubscriptions=r,n.knownFilters=e.knownFilters,a.knownSubscriptions=e.knownSubscriptions,e.userFilters)for(s=0;s<e.userFilters.length;s++){var u=n.fromText(e.userFilters[s]);this.addFilter(u,null,void 0,!0)}this._loading=!1,c.triggerListeners("load"),t!=this.sourceFile&&this.saveToDisk()}.bind(this),o=function(t){this._loading=!0,r(t,0)}.bind(this);if(t)i=!0,o(t);else{i=!1;var u=function(e,i){if(e||!i.exists){var r=require("info").addonRoot;t=Services.io.newURI(r+"defaults/patterns.ini",null,null)}o(t)};(t=d.sourceFile)?e.statFile(t,u):u(!0)}}},_generateFilterData:function(t){var e=[];e.push("# Adblock Plus preferences"),e.push("version=4");for(var i={__proto__:null},r=[],n=0;n<t.length;n++)for(var s=t[n],o=0;o<s.filters.length;o++){var a=s.filters[o];if(!(a.text in i)){a.serialize(r),i[a.text]=a;for(var l=0;l<r.length;l++)e.push(r[l]);r.splice(0)}}for(n=0;n<t.length;n++){s=t[n];e.push(""),s.serialize(r),s.filters.length&&(r.push("","[Subscription filters]"),s.serializeFilters(r));for(l=0;l<r.length;l++)e.push(r[l]);r.splice(0)}return e},_saving:!1,_needsSave:!1,saveToDisk:function(t){var r=!0;if(t||(t=d.sourceFile,r=!1),t)if(r||!this._saving){try{t.parent.create(Ci.nsIFile.DIRECTORY_TYPE,FileUtils.PERMS_DIRECTORY)}catch(t){}var n=function(){e.writeToFile(t,!0,this._generateFilterData(l),function(t){r||(this._saving=!1),t&&Cu.reportError(t),!r&&this._needsSave?(this._needsSave=!1,this.saveToDisk()):c.triggerListeners("save")}.bind(this),"FilterStorageWrite")}.bind(this),s=function(n,s){r||i.patternsbackups<=0?n():e.statFile(t,(function(r,o){if(r||!o.exists)n();else{var a=/^(.*)(\.\w+)$/.exec(t.leafName)||[null,t.leafName,""],l=a[1],u=a[2],c=t.clone();c.leafName=l+"-backup1"+u,e.statFile(c,(function(t,e){t||e.exists&&!((Date.now()-e.lastModified)/36e5>=i.patternsbackupinterval)?n():s(l,u)}))}}))}.bind(this),o=function(r,n){var s=t.clone();s.leafName=r+"-backup"+i.patternsbackups+n,e.removeFile(s,(function(t){return a(r,n,i.patternsbackups-1)}))}.bind(this),a=function(i,r,s){if(s>0){var o=t.clone();o.leafName=i+"-backup"+s+r;var l=i+"-backup"+(s+1)+r;e.renameFile(o,l,(function(t){return a(i,r,s-1)}))}else{var u=t.clone();u.leafName=i+"-backup"+(s+1)+r,e.copyFile(t,u,n)}}.bind(this),l=this.subscriptions.filter((function(t){return!(t instanceof u)}));r||(this._saving=!0),s(n,o)}else this._needsSave=!0},getBackupFiles:function(){for(var t=[],e=/^(.*)(\.\w+)$/.exec(d.sourceFile.leafName)||[null,d.sourceFile.leafName,""],i=e[1],r=e[2],n=1;;n++){var s=d.sourceFile.clone();if(s.leafName=i+"-backup"+n+r,!s.exists())break;t.push(s)}return t}};function p(t){if(t.url in d.knownSubscriptions)for(var e=0;e<t.filters.length;++e){t.filters[e].subscriptions.push(t)}}function h(t){if(t.url in d.knownSubscriptions)for(var e=0;e<t.filters.length;++e){var i=t.filters[e],r=i.subscriptions.indexOf(t);r>=0&&i.subscriptions.splice(r,1)}}var f=t.PrivateBrowsing={enabled:!1,enabledForWindow:function(t){try{return t.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsILoadContext).usePrivateBrowsing}catch(t){return t.result!=Cr.NS_NOINTERFACE&&Cu.reportError(t),!1}},init:function(){if("@mozilla.org/privatebrowsing;1"in Cc)try{this.enabled=Cc["@mozilla.org/privatebrowsing;1"].getService(Ci.nsIPrivateBrowsingService).privateBrowsingEnabled,Services.obs.addObserver(this,"private-browsing",!0),onShutdown.add(function(){Services.obs.removeObserver(this,"private-browsing")}.bind(this))}catch(t){Cu.reportError(t)}},observe:function(t,e,i){"private-browsing"==e&&("enter"==i?this.enabled=!0:"exit"==i&&(this.enabled=!1))},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};function _(){this.fileProperties=this.curObj={},this.subscriptions=[],this.knownFilters={__proto__:null},this.knownSubscriptions={__proto__:null}}return f.init(),_.prototype={subscriptions:null,knownFilters:null,knownSubscrptions:null,wantObj:!0,fileProperties:null,curObj:null,curSection:null,userFilters:null,process:function(t){var e=n.knownFilters;n.knownFilters=this.knownFilters;var i,r=a.knownSubscriptions;a.knownSubscriptions=this.knownSubscriptions;try{if(!0===this.wantObj&&(i=/^(\w+)=(.*)$/.exec(t)))this.curObj[i[1]]=i[2];else if(null===t||(i=/^\s*\[(.+)\]\s*$/.exec(t))){if(this.curObj)switch(this.curSection){case"filter":case"pattern":"text"in this.curObj&&n.fromObject(this.curObj);break;case"subscription":(s=a.fromObject(this.curObj))&&this.subscriptions.push(s);break;case"subscription filters":case"subscription patterns":if(this.subscriptions.length)for(var s=this.subscriptions[this.subscriptions.length-1],o=0;o<this.curObj.length;++o){var l=this.curObj[o],u=n.fromText(l);s.filters.push(u),u.subscriptions.push(s)}break;case"user patterns":this.userFilters=this.curObj}if(null===t)return;switch(this.curSection=i[1].toLowerCase(),this.curSection){case"filter":case"pattern":case"subscription":this.wantObj=!0,this.curObj={};break;case"subscription filters":case"subscription patterns":case"user patterns":this.wantObj=!1,this.curObj=[];break;default:this.wantObj=void 0,this.curObj=null}}else!1===this.wantObj&&t&&this.curObj.push(t.replace(/\\\[/g,"["))}finally{n.knownFilters=e,a.knownSubscriptions=r}}},t}(),require.scopes.elemHide=function(){var t={},e=require("utils").Utils,i=require("io").IO,r=require("prefs").Prefs,n=require("filterClasses").ElemHideException,s=require("filterNotifier").FilterNotifier,o=require("elemHideHitRegistration").AboutHandler,a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},d=null,p=t.ElemHide={isDirty:!1,applied:!1,init:function(){r.addListener((function(t){"enabled"==t&&p.apply()})),onShutdown.add((function(){p.unapply()}));var t=i.resolveFilePath(r.data_directory);t.append("elemhide.css"),d=Services.io.newFileURI(t).QueryInterface(Ci.nsIFileURL)},clear:function(){a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},p.isDirty=!1,p.unapply()},add:function(t){if(t instanceof n){if(t.text in u)return;var e=t.selector;e in c||(c[e]=[]),c[e].push(t),u[t.text]=!0}else{if(t.text in l)return;var i;do{i=Math.random().toFixed(15).substr(5)}while(i in a);a[i]=t,l[t.text]=i,p.isDirty=!0}},remove:function(t){if(t instanceof n){if(!(t.text in u))return;var e=c[t.selector],i=e.indexOf(t);i>=0&&e.splice(i,1),delete u[t.text]}else{if(!(t.text in l))return;var r=l[t.text];delete a[r],delete l[t.text],p.isDirty=!0}},getException:function(t,e){t.selector;if(!(t.selector in c))return null;for(var i=c[t.selector],r=i.length-1;r>=0;r--)if(i[r].isActiveOnDomain(e))return i[r];return null},_applying:!1,_needsApply:!1,apply:function(){if(this._applying)this._needsApply=!0;else if(p.isDirty&&r.enabled)i.writeToFile(d.file,!1,this._generateCSSContent(),function(t){if(this._applying=!1,t&&t.result==Cr.NS_ERROR_NOT_AVAILABLE?i.removeFile(d.file,(function(t){})):t&&Cu.reportError(t),this._needsApply)this._needsApply=!1,this.apply();else if(!t||t.result==Cr.NS_ERROR_NOT_AVAILABLE){if(p.isDirty=!1,p.unapply(),!t)try{e.styleService.loadAndRegisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET),p.applied=!0}catch(t){Cu.reportError(t)}s.triggerListeners("elemhideupdate")}}.bind(this),"ElemHideWrite"),this._applying=!0;else if(r.enabled&&!p.applied)try{e.styleService.loadAndRegisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET),p.applied=!0}catch(t){Cu.reportError(t)}else!r.enabled&&p.applied&&p.unapply()},_generateCSSContent:function(){var t=[],e={__proto__:null},i=!1;for(var r in a){var n=a[r];(u=n.selectorDomain||"")in e?c=e[u]:(c={__proto__:null},e[u]=c),c[n.selector]=r,i=!0}if(!i)throw Cr.NS_ERROR_NOT_AVAILABLE;function s(t){return"\\"+t.charCodeAt(0).toString(16)+" "}var l="-moz-binding: url(about:"+o.aboutPrefix+"?%ID%#dummy) !important;";for(var u in e){var c=e[u];for(var d in u?t.push(('@-moz-document domain("'+u.split(",").join('"),domain("')+'"){').replace(/[^\x01-\x7F]/g,s)):t.push('@-moz-document url-prefix("http://"),url-prefix("https://"),url-prefix("mailbox://"),url-prefix("imap://"),url-prefix("news://"),url-prefix("snews://"){'),c)t.push(d.replace(/[^\x01-\x7F]/g,s)+"{"+l.replace("%ID%",c[d])+"}");t.push("}")}return t},unapply:function(){if(p.applied){try{e.styleService.unregisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET)}catch(t){Cu.reportError(t)}p.applied=!1}},get styleURL(){return p.applied?d.spec:null},getFilterByKey:function(t){return t in a?a[t]:null},getSelectorsForDomain:function(t,e){var i=[];for(var r in a){var n=a[r];(!e||n.domains&&!n.domains[""])&&(n.isActiveOnDomain(t)&&!this.getException(n,t)&&i.push(n.selector))}return i}};return t}(),require.scopes.matcher=function(){var t={},e=require("filterClasses"),i=e.Filter,r=(e.RegExpFilter,e.WhitelistFilter);function n(){this.clear()}function s(){this.blacklist=new n,this.whitelist=new n,this.keys={__proto__:null},this.resultCache={__proto__:null}}t.Matcher=n,n.prototype={filterByKeyword:null,keywordByFilter:null,clear:function(){this.filterByKeyword={__proto__:null},this.keywordByFilter={__proto__:null}},add:function(t){if(!(t.text in this.keywordByFilter)){var e=this.findKeyword(t),i=this.filterByKeyword[e];void 0===i?this.filterByKeyword[e]=t:1==i.length?this.filterByKeyword[e]=[i,t]:i.push(t),this.keywordByFilter[t.text]=e}},remove:function(t){if(t.text in this.keywordByFilter){var e=this.keywordByFilter[t.text],i=this.filterByKeyword[e];if(i.length<=1)delete this.filterByKeyword[e];else{var r=i.indexOf(t);r>=0&&(i.splice(r,1),1==i.length&&(this.filterByKeyword[e]=i[0]))}delete this.keywordByFilter[t.text]}},findKeyword:function(t){var e="",r=t.text;if(i.regexpRegExp.test(r))return e;var n=i.optionsRegExp.exec(r);if(n&&(r=n.input.substr(0,n.index)),"@@"==r.substr(0,2)&&(r=r.substr(2)),t instanceof RedirectFilter)return t.keyword;var s=r.toLowerCase().match(/[^a-z0-9%*][a-z0-9%]{3,}(?=[^a-z0-9%*])/g);if(!s)return e;for(var o=this.filterByKeyword,a=16777215,l=0,u=0,c=s.length;u<c;u++){var d=s[u].substr(1),p=d in o?o[d].length:0;(p<a||p==a&&d.length>l)&&(e=d,a=p,l=d.length)}return e},hasFilter:function(t){return t.text in this.keywordByFilter},getKeywordForFilter:function(t){return t.text in this.keywordByFilter?this.keywordByFilter[t.text]:null},_checkEntryMatch:function(t,e,i,r,n){for(var s=this.filterByKeyword[t],o=0;o<s.length;o++){var a=s[o];if(a.matches(e,i,r,n))return a}return null},matchesAny:function(t,e,i,r){var n=t.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=0,o=n.length;s<o;s++){var a=n[s];if(a in this.filterByKeyword){var l=this._checkEntryMatch(a,t,e,i,r);if(l)return l}}return null}},t.CombinedMatcher=s,s.maxCacheEntries=1e3,s.prototype={blacklist:null,whitelist:null,keys:null,resultCache:null,cacheEntries:0,clear:function(){this.blacklist.clear(),this.whitelist.clear(),this.keys={__proto__:null},this.resultCache={__proto__:null},this.cacheEntries=0},add:function(t){if(t instanceof r)if(t.siteKeys)for(var e=0;e<t.siteKeys.length;e++)this.keys[t.siteKeys[e]]=t.text;else this.whitelist.add(t);else this.blacklist.add(t);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},remove:function(t){if(t instanceof r)if(t.siteKeys)for(var e=0;e<t.siteKeys.length;e++)delete this.keys[t.siteKeys[e]];else this.whitelist.remove(t);else this.blacklist.remove(t);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},findKeyword:function(t){return t instanceof r?this.whitelist.findKeyword(t):this.blacklist.findKeyword(t)},hasFilter:function(t){return t instanceof r?this.whitelist.hasFilter(t):this.blacklist.hasFilter(t)},getKeywordForFilter:function(t){return t instanceof r?this.whitelist.getKeywordForFilter(t):this.blacklist.getKeywordForFilter(t)},isSlowFilter:function(t){var e=t instanceof r?this.whitelist:this.blacklist;return e.hasFilter(t)?!e.getKeywordForFilter(t):!e.findKeyword(t)},matchesAnyInternal:function(t,e,i,r){var n=t.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=null,o=0,a=n.length;o<a;o++){var l=n[o];if(l in this.whitelist.filterByKeyword){var u=this.whitelist._checkEntryMatch(l,t,e,i,r);if(u)return u}l in this.blacklist.filterByKeyword&&null===s&&(s=this.blacklist._checkEntryMatch(l,t,e,i,r))}return s},matchesAny:function(t,e,i,r){var n=t+" "+e+" "+i+" "+r;if(n in this.resultCache)return this.resultCache[n];var o=this.matchesAnyInternal(t,e,i,r);return this.cacheEntries>=s.maxCacheEntries&&(this.resultCache={__proto__:null},this.cacheEntries=0),this.resultCache[n]=o,this.cacheEntries++,o},matchesByKey:function(t,e,r){if((e=e.toUpperCase())in this.keys){var n=i.knownFilters[this.keys[e]];return n&&n.matches(t,"DOCUMENT",r,!1)?n:null}return null}};t.defaultMatcher=new s;return t}(),require.scopes.filterListener=function(){var t={},e=require("filterStorage").FilterStorage,i=require("filterNotifier").FilterNotifier,r=require("elemHide").ElemHide,n=require("matcher").defaultMatcher,s=require("filterClasses"),o=s.ActiveFilter,a=s.RegExpFilter,l=s.ElemHideBase,u=require("prefs").Prefs,c=!1,d=0,p=t.FilterListener={get batchMode(){return c},set batchMode(t){c=t,f()},setDirty:function(t){0==t&&d>0?d=1:d+=t,d>=1&&e.saveToDisk()}},h={observe:function(t,i,r){"browser:purge-session-history"==i&&u.clearStatsOnHistoryPurge&&(e.resetHitCounts(),p.setDirty(0),u.recentReports=[])},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};function f(){!c&&r.isDirty&&r.apply()}function _(t){if(t instanceof o&&!t.disabled){for(var e=!1,i=0;i<t.subscriptions.length;i++)t.subscriptions[i].disabled||(e=!0);e&&(t instanceof a?n.add(t):t instanceof l&&r.add(t))}}function g(t){if(t instanceof o){if(!t.disabled){for(var e=!1,i=0;i<t.subscriptions.length;i++)t.subscriptions[i].disabled||(e=!0);if(e)return}t instanceof a?n.remove(t):t instanceof l&&r.remove(t)}}return i.addListener((function(t,i,s,o){var a=/^(\w+)\.(.*)/.exec(t);a&&"filter"==a[1]?function(t,e,i,r){"hitCount"==t||"lastHit"==t?p.setDirty(.002):p.setDirty(1),"added"!=t&&"removed"!=t&&"disabled"!=t||("added"!=t&&"removed"!=t||!e.disabled)&&("added"==t||"disabled"==t&&0==i?_(e):g(e),f())}(a[2],i,s):a&&"subscription"==a[1]?function(t,i,r,n){if(!(p.setDirty(1),"added"!=t&&"removed"!=t&&"disabled"!=t&&"updated"!=t||"removed"!=t&&!(i.url in e.knownSubscriptions)||("added"==t||"removed"==t||"updated"==t)&&i.disabled)){if("added"==t||"removed"==t||"disabled"==t){var s="added"==t||"disabled"==t&&0==r?_:g;i.filters&&i.filters.forEach(s)}else"updated"==t&&(i.oldFilters.forEach(g),i.filters.forEach(_));f()}}(a[2],i,s):function(t){if("load"==t){d=0,n.clear(),r.clear();for(var i=0;i<e.subscriptions.length;++i){var s=e.subscriptions[i];s.disabled||s.filters.forEach(_)}f()}else"save"==t&&(d=0)}(t)})),"nsIStyleSheetService"in Ci?r.init():f=function(){},e.loadFromDisk(),Services.obs.addObserver(h,"browser:purge-session-history",!0),onShutdown.add((function(){Services.obs.removeObserver(h,"browser:purge-session-history")})),t}(),require.scopes.synchronizer=function(){var t={},e=require("downloader"),i=e.Downloader,r=e.Downloadable,n=e.MILLIS_IN_SECOND,s=e.MILLIS_IN_MINUTE,o=e.MILLIS_IN_HOUR,a=e.MILLIS_IN_DAY,l=require("filterClasses"),u=l.Filter,c=(l.CommentFilter,require("filterStorage").FilterStorage),d=require("filterNotifier").FilterNotifier,p=require("prefs").Prefs,h=require("subscriptionClasses"),f=h.Subscription,_=h.DownloadableSubscription,g=require("utils").Utils,v=6*s,b=1*o,w=5*a,m=null;return(t.Synchronizer={init:function(){m=new i(this._getDownloadables.bind(this),v,b),onShutdown.add((function(){m.cancel()})),m.onExpirationChange=this._onExpirationChange.bind(this),m.onDownloadStarted=this._onDownloadStarted.bind(this),m.onDownloadSuccess=this._onDownloadSuccess.bind(this),m.onDownloadError=this._onDownloadError.bind(this)},isExecuting:function(t){return m.isDownloading(t)},execute:function(t,e){m.download(this._getDownloadable(t,e))},_getDownloadables:function(){var t=[];if(p.subscriptions_autoupdate){for(var e=0;e<c.subscriptions.length;++e){var i=c.subscriptions[e];i instanceof _&&t.push(this._getDownloadable(i,!1))}return t}},_getDownloadable:function(t,e){var i=new r(t.url);return t.lastDownload!=t.lastSuccess&&(i.lastError=t.lastDownload*n),i.lastCheck=t.lastCheck*n,i.lastVersion=t.version,i.softExpiration=t.softExpiration*n,i.hardExpiration=t.expires*n,i.manual=e,i},_onExpirationChange:function(t){var e=f.fromURL(t.url);e.lastCheck=Math.round(t.lastCheck/n),e.softExpiration=Math.round(t.softExpiration/n),e.expires=Math.round(t.hardExpiration/n)},_onDownloadStarted:function(t){var e=f.fromURL(t.url);d.triggerListeners("subscription.downloadStatus",e)},_onDownloadSuccess:function(t,e,i,r){var s=e.split(/[\r\n]+/);if(!(C=/\[Adblock(?:\s*Plus\s*([\d\.]+)?)?\]/i.exec(s[0])))return i("synchronize_invalid_data");for(var l=C[1],d=[],p={redirect:null,homepage:null,title:null,version:null,expires:null},h=0;h<s.length;h++){if(C=/^\s*!\s*(\w+)\s*:\s*(.*)/.exec(s[h])){var _=C[1].toLowerCase(),v=C[2];if(_ in p)p[_]=v,d.push(h);else if("checksum"==_){s.splice(h--,1);var b=g.generateChecksum(s);if(b&&b!=v.replace(/=+$/,""))return i("synchronize_checksum_mismatch")}}}if(p.redirect)return r(p.redirect);var S=f.fromURL(t.redirectURL||t.url);if(t.redirectURL&&t.redirectURL!=t.url){var x=f.fromURL(t.url);S.title=x.title,S.disabled=x.disabled,S.lastCheck=x.lastCheck;var y=x.url in c.knownSubscriptions;y&&c.removeSubscription(x),delete f.knownSubscriptions[x.url],y&&c.addSubscription(S)}S.lastSuccess=S.lastDownload=Math.round(Date.now()/n),S.downloadStatus="synchronize_ok",S.errors=0;for(h=d.length-1;h>=0;h--)s.splice(d[h],1);if(p.homepage){var E=g.makeURI(p.homepage);!E||"http"!=E.scheme&&"https"!=E.scheme||(S.homepage=E.spec)}p.title?(S.title=p.title,S.fixedTitle=!0):S.fixedTitle=!1,S.version=p.version?parseInt(p.version,10):0;var C,k=w;if(p.expires&&(C=/^(\d+)\s*(h)?/.exec(p.expires))){var D=parseInt(C[1],10);k=C[2]?D*o:D*a}var F=m.processExpirationInterval(k),I=F[0],L=F[1];if(S.softExpiration=Math.round(I/n),S.expires=Math.round(L/n),delete S.requiredVersion,delete S.upgradeRequired,l){var R=require("info").addonVersion;S.requiredVersion=l,Services.vc.compare(l,R)>0&&(S.upgradeRequired=!0)}s.shift();for(var O=[],T=0;T<s.length;++T){var N=s[T];(N=u.normalize(N))&&O.push(u.fromText(N))}c.updateSubscriptionFilters(S,O)},_onDownloadError:function(t,e,i,r,s,o){var a=f.fromURL(t.url);if(a.lastDownload=Math.round(Date.now()/n),a.downloadStatus=i,!t.manual&&(a.errors++,o&&a.errors>=p.subscriptions_fallbackerrors&&/^https?:\/\//i.test(a.url))){a.errors=0;var l=p.subscriptions_fallbackurl,u=require("info").addonVersion;l=(l=(l=(l=(l=(l=l.replace(/%VERSION%/g,encodeURIComponent(u))).replace(/%SUBSCRIPTION%/g,encodeURIComponent(a.url))).replace(/%URL%/g,encodeURIComponent(e))).replace(/%ERROR%/g,encodeURIComponent(i))).replace(/%CHANNELSTATUS%/g,encodeURIComponent(r))).replace(/%RESPONSESTATUS%/g,encodeURIComponent(s));var d=new XMLHttpRequest;d.mozBackgroundRequest=!0,d.open("GET",l),d.overrideMimeType("text/plain"),d.channel.loadFlags=d.channel.loadFlags|d.channel.INHIBIT_CACHING|d.channel.VALIDATE_ALWAYS,d.addEventListener("load",(function(t){if(!onShutdown.done&&a.url in c.knownSubscriptions){var e=/^(\d+)(?:\s+(\S+))?$/.exec(d.responseText);if(e&&"301"==e[1]&&e[2]&&/^https?:\/\//i.test(e[2]))o(e[2]);else if(e&&"410"==e[1]){var i="[Adblock]\n"+a.filters.map((function(t){return t.text})).join("\n");o("data:text/plain,"+encodeURIComponent(i))}}}),!1),d.send(null)}}}).init(),t}(),require.scopes.notification=function(){var t={},e=require("prefs").Prefs,i=require("downloader"),r=i.Downloader,n=i.Downloadable,s=i.MILLIS_IN_MINUTE,o=i.MILLIS_IN_HOUR,a=(i.MILLIS_IN_DAY,require("utils").Utils),l=12*s,u=1*o,c=2*o;function d(t){var e={information:0,critical:1};return t.severity in e?e[t.severity]:e.information}function p(){e.notificationdata=JSON.parse(JSON.stringify(e.notificationdata))}function h(t,e){if(e in t)return t[e];var i=e.substring(0,e.indexOf("-"));if(i&&i in t)return t[i];return t["en-US"]}var f=null;return(t.Notification={init:function(){f=new r(this._getDownloadables.bind(this),l,u),onShutdown.add((function(){f.cancel()})),f.onExpirationChange=this._onExpirationChange.bind(this),f.onDownloadSuccess=this._onDownloadSuccess.bind(this),f.onDownloadError=this._onDownloadError.bind(this)},_getDownloadables:function(){var t=[],i=new n(e.notificationurl);return"number"==typeof e.notificationdata.lastError&&(i.lastError=e.notificationdata.lastError),"number"==typeof e.notificationdata.lastCheck&&(i.lastCheck=e.notificationdata.lastCheck),"object"==typeof e.notificationdata.data&&"version"in e.notificationdata.data&&(i.lastVersion=e.notificationdata.data.version),"number"==typeof e.notificationdata.softExpiration&&(i.softExpiration=e.notificationdata.softExpiration),"number"==typeof e.notificationdata.hardExpiration&&(i.hardExpiration=e.notificationdata.hardExpiration),t.push(i),t},_onExpirationChange:function(t){e.notificationdata.lastCheck=t.lastCheck,e.notificationdata.softExpiration=t.softExpiration,e.notificationdata.hardExpiration=t.hardExpiration,p()},_onDownloadSuccess:function(t,i,r,n){function s(t){if("false"!==localStorage.notificationRules&&chrome&&chrome.notifications){""===t.icon&&(t.icon=chrome.runtime.getURL("/icons/abp-128.png"));var e=[{title:"马上去看看",iconUrl:chrome.runtime.getURL("/img/car.png")},{title:"选项设置",iconUrl:chrome.runtime.getURL("/img/setting.png")}],i={type:"basic",title:t.title,message:t.message,iconUrl:t.icon,buttons:e};chrome.notifications.create("push"+t.time,i,(function(){}))}}function o(t){chrome.notifications&&(chrome.notifications.onButtonClicked.addListener((function(e,i){if(e=="push"+t.time)switch(i){case 0:chrome.tabs.create({url:t.link});break;case 1:chrome.tabs.create({url:"options.html"})}})),chrome.notifications.onClicked.addListener((function(e){e=="push"+t.time&&chrome.tabs.create({url:t.link})})))}try{e.notificationdata.data=JSON.parse(i)}catch(t){return Cu.reportError(t),void r("synchronize_invalid_data")}e.notificationdata.lastError=0,e.notificationdata.downloadStatus="synchronize_ok";var a=f.processExpirationInterval(c);e.notificationdata.softExpiration=a[0],e.notificationdata.hardExpiration=a[1],p();var l=e.notificationdata;l.data.notifications||(l.data.notifications=[]);var u=l.data.notifications,d=l.hasNontifacationTime;null==d&&(d=0);for(var h=0,_=0;_<u.length;_++)u[_].time>d&&(!function(t,i){setTimeout((function(){console.log(t),s(t),o(t),e.notificationdata.hasNontifacationTime=t.time,p()}),20*i*60*1e3)}(u[_],h),h+=1);var g=l.data.subscriptions;for(_=0;_<FilterStorage.subscriptions.length;_++)for(var v=FilterStorage.subscriptions[_],b=0;b<g.length;b++)v.url==g[b].url&&g[b].version>v.version&&Synchronizer.execute(v,!0,!0)},_onDownloadError:function(t,i,r,n,s,o){e.notificationdata.lastError=Date.now(),e.notificationdata.downloadStatus=r,p()},getNextToShow:function(){function t(t,e,i,r){var n=e+"MinVersion",s=e+"MaxVersion";return!(e in t&&t[e]!=i||n in t&&Services.vc.compare(r,t[n])<0||s in t&&Services.vc.compare(r,t[s])>0)}if("object"!=typeof e.notificationdata.data||!(e.notificationdata.data.notifications instanceof Array))return null;e.notificationdata.shown instanceof Array||(e.notificationdata.shown=[],p());for(var i=require("info"),r=i.addonName,n=i.addonVersion,s=i.application,o=i.applicationVersion,a=i.platform,l=i.platformVersion,u=e.notificationdata.data.notifications,c=null,h=0;h<u.length;++h){var f=u[h];if(void 0!==f.severity&&"information"!==f.severity||-1===e.notificationdata.shown.indexOf(f.id)){if(f.targets instanceof Array){for(var _=!1,g=0;g<f.targets.length;++g){var v=f.targets[g];if(t(v,"extension",r,n)&&t(v,"application",s,o)&&t(v,"platform",a,l)){_=!0;break}}if(!_)continue}(!c||d(f)>d(c))&&(c=f)}}return c&&"id"in c&&(e.notificationdata.shown.push(c.id),p()),c},getLocalizedTexts:function(t,e){e=e||a.appLocale;for(var i=["title","message"],r=[],n=0;n<i.length;++n){var s=i[n];s in t&&(r[s]=h(t[s],e))}return r}}).init(),t}(),require.scopes.cscript=function(){var t={},e=require("downloader"),i=e.Downloader,r=e.Downloadable,n=e.MILLIS_IN_MINUTE,s=e.MILLIS_IN_HOUR,o=(e.MILLIS_IN_DAY,require("utils").Utils,12*n),a=1*s,l=3*s,u=null;return(t.Cscript={_cscripts:null,get cscripts(){return null==this._cscripts&&(null!=localStorage.CSCRIPTS?this._cscripts=JSON.parse(localStorage.CSCRIPTS):this._cscripts={list:[]}),this._cscripts},setDirty:function(){localStorage.CSCRIPTS=JSON.stringify(this._cscripts)},init:function(){u=new i(this._getDownloadables.bind(this),o,a),onShutdown.add((function(){u.cancel()})),u.onExpirationChange=this._onExpirationChange.bind(this),u.onDownloadSuccess=this._onDownloadSuccess.bind(this),u.onDownloadError=this._onDownloadError.bind(this)},_getDownloadables:function(){for(var t=[],e=this.cscripts.list,i=e.length-1;i>=0;i--){var n=new r(e[i].link);"number"==typeof e[i].lastError&&(n.lastError=e[i].lastError),"number"==typeof e[i].lastCheck&&(n.lastCheck=e[i].lastCheck),"number"==typeof e[i].softExpiration&&(n.softExpiration=e[i].softExpiration),"number"==typeof e[i].hardExpiration&&(n.hardExpiration=e[i].hardExpiration),t.push(n)}return t},_onExpirationChange:function(t){var e=this.getScript(t.url);e.lastCheck=t.lastCheck,e.softExpiration=t.softExpiration,e.hardExpiration=t.hardExpiration,this.setDirty()},_onDownloadSuccess:function(t,e,i,r){if("true"===localStorage.debug)var n=e.split(/[\r\n]+/);else n=decodeURIComponent(escape(window.atob(e))).split(/[\r\n]+/);for(var s=this.getScript(t.url),o="",a=1;a<n.length;a++){var c=/^\s*!\s*(\w+)\s*:\s*(.*)/.exec(n[a]);if(c){var d=c[1].toLowerCase(),p=c[2];["checksum","version","title","homepage","match"].indexOf(d)&&(s[d]=p)}else o+=n[a]+"\n"}this.setDirty(),localStorage[t.url]=o;var h=u.processExpirationInterval(l);(s=this.getScript(t.url)).softExpiration=h[0],s.hardExpiration=h[1],s.lastCheck=Date.now(),this.setDirty(),FilterNotifier.triggerListeners("cscript.downloadStatus",s)},_onDownloadError:function(t,e,i,r,n,s){},execute:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--){var n=new r(e[i].link);"number"==typeof e[i].lastError&&(n.lastError=e[i].lastError),"number"==typeof e[i].lastCheck&&(n.lastCheck=e[i].lastCheck),"number"==typeof e[i].softExpiration&&(n.softExpiration=e[i].softExpiration),"number"==typeof e[i].hardExpiration&&(n.hardExpiration=e[i].hardExpiration),FilterNotifier.triggerListeners("cscript.downloadStart",e[i]),u.download(n)}},add:function(t,e){null==this.getScript(e)&&(this.cscripts.list.push({title:t,link:e,enabled:!0}),this.setDirty(),FilterNotifier.triggerListeners("cscript.added",t,e),this.execute(e))},remove:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)if(e[i].link==t){localStorage.removeItem(e[i].link),e.splice(i,1),FilterNotifier.triggerListeners("cscript.removed",t),this.setDirty();break}},enable:function(t,e){for(var i=this.cscripts.list,r=i.length-1;r>=0;r--)if(i[r].link==t){i[r].enabled=e,this.setDirty();break}},updateScript:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)e[i].link==t.link&&link[i]},getScript:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)if(e[i].link==t)return e[i];return null},exeScript:function(t){for(var e=this.cscripts.list,i=[],r=e.length-1;r>=0;r--){var n=new RegExp(e[r].match);e[r].enabled&&n.test(t)&&i.push(localStorage[e[r].link])}return i}}).init(),t}(),require.scopes.stats=function(){var t={},e=require("prefs").Prefs,i=require("filterClasses").BlockingFilter,r=require("filterNotifier").FilterNotifier;t.getStats=function(t,i){if(i){var r=getFrameData(i,0);return r&&t in r?r[t]:0}return t in e.stats_total?e.stats_total[t]:0};return r.addListener((function(t,r,n,s,o){if("filter.hitCount"==t&&(r instanceof i||r instanceof RedirectFilter)){"blocked"in e.stats_total?e.stats_total.blocked++:e.stats_total.blocked=1,e.stats_total=e.stats_total;var a=getFrameData(o,0);a&&("blocked"in a?a.blocked++:a.blocked=1)}})),t}();