(e=>{function t(t){for(var s,i,a=t[0],c=t[1],l=t[2],d=0,p=[];d<a.length;d++)i=a[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(u&&u(t);p.length;)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],s=!0,a=1;a<r.length;a++){var c=r[a];0!==o[c]&&(s=!1)}s&&(n.splice(t--,1),e=i(i.s=r[0]))}return e}var s={},o={4:0},n=[];function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=s,i.d=(e,t,r)=>{i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=(e,t)=>{if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,(t=>e[t]).bind(null,s));return r},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,"a",t),t},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;n.push([132,3,0]),r()})({132:function(e,t,r){"use strict";r.r(t);var s=r(0),o=r(4),n=r(10),i=r(1),a=r(40);const c={};function l(e){browser.notifications.create(e.id||"ViolentMonkey",{type:"basic",iconUrl:s.e,title:`${e.title} - ${Object(s.n)("extName")}`,message:e.body,isClickable:e.isClickable})}async function u(e){const t=await browser.tabs.query({});let r=0;for(const s of t)e(s),r+=1,r%20==0&&await new Promise(setTimeout)}const d=Object(a.a)({lifetime:3e5});Object.assign(c,{CacheLoad:e=>d.get(e)||null,CacheHit(e){d.hit(e.key,e.lifetime)}});var p=d,h=r(19);const f=[],m=[];Object.assign(c,{GetAllOptions:()=>c.GetOptions(h.a),GetOptions:e=>i.d.call(e,([e])=>j(e)),SetOptions(e){Object(s.g)(e).forEach(e=>k(e.key,e.value))}});let g={};const b=Object(s.o)(),y=Object(s.d)(()=>{b.fire(g),g={}},100);let w={},v=browser.storage.local.get("options").then(({options:e})=>{e&&"object"==typeof e&&(w=e),Object(i.f)(w,"version")||k("version",1),v=null});function j(e,t){const r=Object(s.u)(e),o=r[0];let n=w[o];return null==n&&(n=h.a[o]),null==n&&(n=t),r.length>1?Object(i.f)(n,r.slice(1),t):n}function O(e){return Object(i.f)(h.a,e)}function k(e,t){if(v)return void v.then(()=>{k(e,t)});const r=Object(s.u)(e);r.join(".");let o=t;const n=r[0];n in h.a&&(r.length>1&&(o=Object(i.i)(j(n),r.slice(1),t)),w[n]=o,browser.storage.local.set({options:w}),((e,t)=>{Object(i.i)(g,e,t),y()})(r,t))}f.push(v);const x=b.hook;function S(e){return Object.entries(e).map(e=>e.map(encodeURIComponent).join("=")).join("&")}var U=r(5),T=r.n(U),$=r(6),M=new class{constructor(e){this.events={},this.allowed=e}checkType(e){if(this.allowed&&!this.allowed.includes(e))throw new Error(`Unknown event type: ${e}`)}on(e,t){this.checkType(e);const{events:r}=this;let s=r[e];return s||(s=[],r[e]=s),()=>this.off(e,t)}off(e,t){this.checkType(e);const r=this.events[e];if(r){const e=r.indexOf(t);e>=0&&r.splice(e,1)}}emit(e,t){this.checkType(e);const r=this.events[e];if(r){const s={type:e,data:t,defaultPrevented:!1,preventDefault(){s.defaultPrevented=!0}};r.some(e=>(e(s),s.defaultPrevented))}}}(["scriptEdit","scriptChanged"]);Object.assign(c,{CacheNewScript(e){const t=Object(s.m)();return p.put(`new-${t}`,R(e)),t},InjectScript:(e,{tab:t,frameId:r})=>browser.tabs.executeScript(t.id,{code:e,frameId:r,runAt:"document_start"}),NewScript:e=>e&&p.get(`new-${e}`)||R(),ParseMeta:P});const I={default:()=>[],transform:(e,t)=>(e.push(t),e)},_={default:()=>null,transform:(e,t)=>null==e?t:e},C={include:I,exclude:I,match:I,excludeMatch:I,require:I,resource:{default:()=>({}),transform:(e,t)=>{const r=t.match(/^(\w\S*)\s+(.*)/);return r&&(e[r[1]]=r[2]),e}},grant:I,noframes:{default:()=>!1,transform:()=>!0}};function P(e){const t=i.d.call(C,([,e])=>e.default());return(e.match(o.g)[1]||"").replace(/(?:^|\n)\s*\/\/\x20(@\S+)(.*)/g,(e,r,s)=>{const[o,n]=r.slice(1).split(":"),i=o.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()),a=n?`${i}:${n.toLowerCase()}`:i,c=s.trim(),l=C[a]||_;let u=t[a];void 0===u&&(u=l.default()),t[a]=l.transform(u,c)}),t.resources=t.resource,delete t.resource,!t.homepageURL&&t.homepage&&(t.homepageURL=t.homepage),t}function R(e){const t=T()({url:"*://*/*",name:"",date:(new Date).toLocaleString()},e),r=j("scriptTemplate").replace(/{{(\w+)}}/g,(e,r)=>{const s=t[r];return null==s?e:s});return{script:{custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:P(r)},code:r}}function D(e){const t=e.meta.namespace||"",r=e.meta.name||"";let o=Object(s.f)(`${t}\n${r}\n`);return t||r||(o+=e.props.id||""),o}var E=r(20);Object.assign(c,{TestBlacklist:Z}),m.push(K),E.c(!0);const L=/(.*?):\/\/([^/]*)\/(.*)/;let A=[];x(e=>{"blacklist"in e&&K(e.blacklist||"")});const z=/^https?$/i;let N={},q=0;function V(e,t,r,s){return t.some(t=>{const o=`${r}:${t}`;let n=p.get(o);return n?p.hit(o):p.put(o,n=s(t)),n.test(e)})}function H(e,t){return V(e,t,"re",J)}function B(e,t){return V(e,t,"match",X)}function F(...e){return e.reduce((e,t)=>t?e.concat(t):e,[])}function G(e){return e.replace(/([.?+[\]{}()|^$])/g,"\\$1").replace(/\*/g,".*?")}function W(e){return e.test.bind(e)}function J(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return{test:W(new RegExp(e.slice(1,-1)))};const t=G(e);if(E.d()&&e.includes(".tld/")){const e=t.replace("\\.tld/","((?:\\.\\w+)+)/");return{test:t=>{const r=t.match(e);if(r){const e=r[1].slice(1);if(E.b(e)===e)return!0}return!1}}}return{test:W(new RegExp(`^${t}$`))}}function X(e){let t;if("<all_urls>"===e)t=()=>!0;else{const r=e.match(L);if(r){const e=(e=>{let t="",r=e,s="";e.startsWith("*.")&&(r=r.slice(2),t="(?:|.*?\\.)"),E.d()&&e.endsWith(".tld")&&(r=r.slice(0,-4),s="((?:\\.\\w+)+)");const o=new RegExp(`^${t}${G(r)}${s}$`);return t=>{if("*"===e)return 1;if(e===t)return 1;const r=t.match(o);if(r){const[,e]=r;if(!e)return 1;const t=e.slice(1);return E.b(t)===t}return 0}})(r[2]),s=(e=>{const t=e.indexOf("#");let r=e.indexOf("?"),s=G(e);return r>t&&(r=-1),t<0&&(s=r<0?`^${s}(?:[?#]|$)`:`^${s}(?:#|$)`),W(new RegExp(s))})(r[3]);t=t=>{const o=t.match(L);return!!r&&!!o&&((e,t)=>e===t?1:["*","http*"].includes(e)&&z.test(t)?1:0)(r[1],o[1])&&e(o[2])&&s(o[3])}}else t=()=>!1}return{test:t}}function Z(e){let t=N[e];if(void 0===t){const o=A.find(({test:t})=>t(e));t=(null==o?void 0:o.reject)&&o.text,s=t||!1,N[r=e]=s,q+=r.length,q>1e5&&Object.keys(N).some(e=>(q-=e.length,delete N[e],q<75e3))}var r,s;return t}function K(e){p.batch(!0);const t=null==e?j("blacklist"):e;A=(Array.isArray(t)?t:(t||"").split("\n")).map(e=>{if(!(e=e.trim())||e.startsWith("#"))return null;const t=e.startsWith("@")&&e.split(/\s/,1)[0],r=t?e.slice(t.length+1).trim():e,s="@include"!==t&&"@match"!==t,{test:o}="@include"===t||"@exclude"===t&&J(r)||!t&&!r.includes("/")&&X(`*://${r}/*`)||X(r);return{reject:s,test:o,text:e}}).filter(Boolean),N={},q=0,p.batch(!1)}const Q={};function Y(e){return+e||0}function ee(e){return null==e?void 0:e.props.id}async function te(){const e=Q.scripts.filter(({props:e},t)=>{const r=t+1,s=e.position!==r;return s&&(e.position=r),s});return Q.storeInfo.position=Q.scripts.length,e.length&&(await $.a.script.dump(e),k("lastModified",Date.now())),e.length}async function re(){Q.scripts.sort((e,t)=>Y(e.props.position)-Y(t.props.position));const e=await te();return Object(s.w)("ScriptsUpdated",null),e}function se(e){return Q.scriptMap[e]}function oe({id:e,uri:t,meta:r}){let s;return e?s=se(e):(t||(t=D({meta:r,id:"@@should-have-name"})),s=Q.scripts.find(({props:e})=>t===e.uri)),s}function ne(){return Q.scripts.filter(e=>!e.config.removed)}function ie(e){return $.a.value.getMulti(e)}async function ae(e){return await $.a.value.dump(e),e}$.a.script.onDump=e=>{Q.scriptMap[e.props.id]=e},Object.assign(c,{CheckPosition:re,CheckRemove:ue,CheckScript({name:e,namespace:t}){const r=oe({meta:{name:e,namespace:t}});return r&&!r.config.removed?r.meta.version:null},async ExportZip({values:e}){const t=ne(),r=t.map(ee),s=await $.a.code.getMulti(r);return{items:t.map(e=>({script:e,code:s[e.props.id]})),values:e?await $.a.value.getMulti(r):void 0}},GetScriptCode:e=>$.a.code.getOne(e),GetMetas:e=>e.map(se).filter(Boolean),MarkRemoved:({id:e,removed:t})=>de(e,{config:{removed:t?1:0},props:{lastModified:Date.now()}}),Move({id:e,offset:t}){const r=se(e),s=Q.scripts.indexOf(r);return Q.scripts.splice(s,1),Q.scripts.splice(s+t,0,r),te()},async RemoveScript(e){const t=Q.scripts.indexOf(se(e));return t>=0&&(Q.scripts.splice(t,1),await Promise.all([$.a.script.remove(e),$.a.code.remove(e),$.a.value.remove(e)])),Object(s.w)("RemoveScript",e)},ParseMeta:P,ParseScript:pe,UpdateScriptInfo:({id:e,config:t})=>de(e,{config:t,props:{lastModified:Date.now()}}),Vacuum:async()=>{const e={},t={},r={},o={},n=[[$.a.value,e],[$.a.cache,t],[$.a.require,r],[$.a.code,o]],a=await browser.storage.local.get();i.b.call(a,e=>{n.some(([t,r])=>{const{prefix:s}=t;return!!e.startsWith(s)&&(r[e.slice(s.length)]=-1,!0)})});const c=(e,t)=>{e[t]<0?e[t]=1:e[t]||(e[t]=2)};Q.scripts.forEach(n=>{var a;const{id:l}=n.props;c(o,l),c(e,l),n.custom.pathMap||he(n);const{pathMap:u}=n.custom;n.meta.require.forEach(e=>{c(r,u[e]||e)}),(a=n.meta.resources,i.c).call(a,e=>{c(t,u[e]||e)});const{icon:d}=n.meta;if(Object(s.q)(d)){const e=u[d]||d;c(t,e)}}),n.forEach(([e,t])=>{i.a.call(t,([t,r])=>{r<0?e.remove(t):2===r&&e.fetch&&e.fetch(t)})})}}),f.push(async()=>{const{version:e}=await browser.storage.local.get("version"),{version:t}=browser.runtime.getManifest();e||await new Promise((e,t)=>{console.info("Upgrade database..."),(()=>{const r=indexedDB.open("Violentmonkey",1);r.onsuccess=()=>{try{(r=>{const s=r.transaction(["scripts","require","cache","values"]),o={};let n=3;const i=()=>{n-=1,n||e(browser.storage.local.set(o))},a=(e,r)=>{const o=s.objectStore(e).getAll();o.onsuccess=()=>r(o.result),o.onerror=t};a("scripts",e=>{const t={};e.forEach(e=>{const{code:r,id:s,uri:n}=e;o[`${$.a.script.prefix}${s}`]=(e=>({meta:P(e.code),custom:Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom),props:{id:e.id,uri:e.uri,position:e.position},config:{enabled:e.enabled,shouldUpdate:e.update}}))(e),o[`${$.a.code.prefix}${s}`]=r,t[n]=s}),a("values",e=>{e.forEach(({uri:e,values:r})=>{const s=t[e];s&&(o[`${$.a.value.prefix}${s}`]=r)}),i()})}),a("cache",e=>{e.forEach(({uri:e,data:t})=>{o[`${$.a.cache.prefix}${e}`]=t}),i()}),a("require",e=>{e.forEach(({uri:e,code:t})=>{o[`${$.a.require.prefix}${e}`]=t}),i()})})(r.result)}catch(e){t(e)}},r.onerror=t,r.onupgradeneeded=()=>{t()}})()}).catch(()=>{}),t!==e&&browser.storage.local.set({version:t});const r=await browser.storage.local.get(),s=[],o={id:0,position:0},n={},a={};return i.a.call(r,([e,t])=>{if(e.startsWith($.a.script.prefix)){const r=Y(e.slice($.a.script.prefix.length));if(!r||n[r])return;n[r]=t;const i=D(t);if(a[i])return;a[i]=t,t.props=T()({},t.props,{id:r,uri:i}),t.custom=T()({},{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},{},t.custom),o.id=Math.max(o.id,r),o.position=Math.max(o.position,Y(t.props.position)),s.push(t)}}),Object.assign(Q,{scripts:s,storeInfo:o,scriptMap:s.reduce((e,t)=>(e[t.props.id]=t,e),{})}),re()});const ce=["GM_getValue","GM.getValue","GM_setValue","GM.setValue","GM_listValues","GM.listValues","GM_deleteValue","GM.deleteValue"];async function le(e,t){const r=Z(e)?[]:Q.scripts.filter(r=>!r.config.removed&&(t||!r.meta.noframes)&&((e,t)=>{p.batch(!0);const{custom:r,meta:s}=t,o=F(r.origMatch&&s.match,r.match),n=F(r.origInclude&&s.include,r.include),i=F(r.origExclude&&s.exclude,r.exclude),a=F(r.origExcludeMatch&&s.excludeMatch,r.excludeMatch);let c=!o.length&&!n.length;return c=c||B(e,o),c=c||H(e,n),c=c&&!B(e,a),c=c&&!H(e,i),p.batch(!1),c})(e,r)),s={},o={},n=r.filter(e=>e.config.enabled);n.forEach(e=>{var t;const{meta:r,custom:n}=e,{pathMap:a=he(e)}=n;r.require.forEach(e=>{s[a[e]||e]=1}),(t=r.resources,i.c).call(t,e=>{o[a[e]||e]=1})});const a=r.map(ee),c=n.map(ee),l=n.filter(e=>{var t;return null==(t=e.meta.grant)?void 0:t.some(e=>ce.includes(e))}).map(ee),[u,d,h,f]=await Promise.all([$.a.require.getMulti(Object.keys(s)),$.a.cache.getMulti(Object.keys(o)),$.a.value.getMulti(l,{}),$.a.code.getMulti(c)]);return Object.defineProperties({cache:d,code:f,enabledIds:c,ids:a,require:u,scripts:n,values:h},{withValueIds:{value:l}})}function ue({force:e}={}){const t=Date.now(),r=Q.scripts.filter(r=>r.config.removed&&(e||t-Y(r.props.lastModified)>o.k));if(r.length){Q.scripts=Q.scripts.filter(e=>!e.config.removed);const e=r.map(ee);$.a.script.removeMulti(e),$.a.code.removeMulti(e),$.a.value.removeMulti(e)}return r.length}async function de(e,t){const r=Q.scriptMap[e];if(!r)throw null;return r.props=T()({},r.props,{},t.props),r.config=T()({},r.config,{},t.config),await $.a.script.dump(r),Object(s.w)(o.b,{where:{id:e},update:r})}async function pe(e){const t=P(e.code);if(!t.name)throw Object(s.n)("msgInvalidScript");const r={update:{message:null==e.message?Object(s.n)("msgUpdated"):e.message||""}};let n,a=o.b;const c=await oe({id:e.id,meta:t});if(c){if(e.isNew)throw Object(s.n)("msgNamespaceConflict");n=T()({},c)}else({script:n}=R()),a=o.a,r.isNew=!0,r.update.message=Object(s.n)("msgInstalled");return n.config=T()({},n.config,{},e.config,{removed:0}),n.custom=T()({},n.custom,{},e.custom),n.props=T()({},n.props,{lastModified:Date.now(),lastUpdated:Date.now()},e.props),n.meta=t,t.homepageURL||n.custom.homepageURL||!Object(s.q)(e.from)||(n.custom.homepageURL=e.from),Object(s.q)(e.url)&&(n.custom.lastInstallURL=e.url),e.position&&(n.props.position=+e.position),he(n,e.url),await async function(e,t){const r=e.config||{};r.enabled=Y(r.enabled),r.shouldUpdate=Y(r.shouldUpdate);const o=e.props||{};let n;if(o.id?n=Q.scriptMap[o.id]:(Q.storeInfo.id+=1,o.id=Q.storeInfo.id),o.uri=D(e),o.uuid=o.uuid||`${(o.id+280880802).toString(16).slice(-8)}-${Object(s.l)()}-${Object(s.l)()}-${Object(s.l)()}-${Object(s.l)()}${Object(s.l)()}${Object(s.l)()}`,Q.scripts.some(({props:{id:e,uri:t}={}})=>o.id!==e&&o.uri===t))throw Object(s.n)("msgNamespaceConflict");if(n){e.config=T()({},n.config,{},r),e.props=T()({},n.props,{},o);const t=Q.scripts.indexOf(n);Q.scripts[t]=e}else o.position?Q.storeInfo.position<o.position&&(Q.storeInfo.position=o.position):(Q.storeInfo.position+=1,o.position=Q.storeInfo.position),e.config=r,e.props=o,Q.scripts.push(e);return Promise.all([$.a.script.dump(e),$.a.code.set(o.id,t)])}(n,e.code),((e,t)=>{var r;const{meta:o,custom:{pathMap:n}}=e;if(o.require.forEach(e=>{var r;const s=n[e]||e,o=null==(r=t.require)?void 0:r[s];o?$.a.require.set(s,o):$.a.require.fetch(s)}),(r=o.resources,i.c).call(r,e=>{var r;const s=n[e]||e,o=null==(r=t.resources)?void 0:r[s];o?$.a.cache.set(s,o):$.a.cache.fetch(s)}),Object(s.q)(o.icon)){const e=n[o.icon]||o.icon;$.a.cache.fetch(e,({blob:e})=>new Promise((t,r)=>{const s=e(),o=URL.createObjectURL(s),n=new Image,i=()=>URL.revokeObjectURL(o);n.onload=()=>{i(),t()},n.onerror=()=>{i(),r({type:"IMAGE_ERROR",url:o})},n.src=o}))}})(n,e),Object.assign(r.update,n,e.update),r.where={id:n.props.id},Object(s.w)(a,r),M.emit("scriptChanged",r),r}function he(e,t){const{meta:r}=e,o=t||e.custom.lastInstallURL,n=o?[...r.require,...Object.values(r.resources),r.icon].reduce((e,t)=>{if(t){const r=Object(s.j)(t,o);r!==t&&(e[t]=r)}return e},{}):{};return e.custom.pathMap=n,n}const fe={update:c.ParseScript,list:async()=>ne(),get:c.GetScriptCode,remove:e=>c.MarkRemoved({id:e,removed:!0})},me=[],ge=[],be={},ye=Object(s.d)(Re,o.i);let we,ve=Promise.resolve();function je({name:e,uri:t}){return e||`vm@2-${t}`}function Oe(e){return/^vm(?:@\d+)?-/.test(e)}function ke(e){const t=e.indexOf("-"),[,r]=e.slice(0,t).split("@");if("2"===r)return e.slice(t+1);try{return decodeURIComponent(e.slice(3))}catch(t){return e.slice(3)}}function xe(e,t,r){let o=t||e[0];function n(){return o}return{get:n,set:t=>(e.includes(t)?(o=t,r&&r()):console.warn("Invalid state:",t),n()),is:e=>Object(s.g)(e).includes(o)}}function Se(){return me.map(e=>{const t=be[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress,properties:t.properties,userConfig:t.getUserConfig()}})}function Ue(e){const t=function(){this.initialize()};return t.prototype=e,t.extend=Te,t}function Te(e){return Ue(Object.assign(Object.create(this.prototype),e))}const $e=Object(s.d)(()=>{Object(s.w)("UpdateSync",Se())}),Me=Ue({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"Violentmonkey",properties:{authType:"oauth"},getUserConfig:s.t,setUserConfig:s.t,initialize(){this.progress={finished:0,total:0},this.config=(e=>{function t(t){const r=Object(s.u)(t);return r.unshift("services",e),r}return{get:(e,r)=>we.get(t(e),r),set:(e,r)=>{"object"==typeof e?i.a.call(e,([e,r])=>{we.set(t(e),r)}):we.set(t(e),r)},clear:()=>{we.set(t(),{})}}})(this.name),this.authState=xe(["idle","initializing","authorizing","authorized","unauthorized","error"],null,$e),this.syncState=xe(["idle","ready","syncing","error"],null,$e),this.lastFetch=Promise.resolve(),this.startSync=this.syncFactory();const e=(()=>{const e={};return{on:(t,r)=>{let s=e[t];s||(s=[],e[t]=s),s.push(r)},off:(t,r)=>{const s=e[t];if(s){const e=s.indexOf(r);e>=0&&s.splice(e,1)}},fire:(t,r)=>{const s=e[t];s&&s.forEach(e=>{e(r,t)})}}})();["on","off","fire"].forEach(t=>{this[t]=(...r)=>{e[t](...r)}})},log(...e){console.log(...e)},syncFactory(){let e,t;const r=()=>this.authState.is("authorized")&&_e()===this.name,o=()=>{if(!r())return Promise.resolve();this.log("Ready to sync:",this.displayName),this.syncState.set("ready"),ve=ve.then(()=>new Promise(e=>{t=Object(s.d)(e,1e4),t()})).then(()=>{if(r())return this.sync();this.syncState.set("idle")}).catch(e=>{console.error(e)}).then(()=>{e=null,t=null}),e=ve};return()=>(e||o(),t&&t(),e)},prepareHeaders(){this.headers={}},prepare(){return this.authState.set("initializing"),(this.initToken()?Promise.resolve(this.user()):Promise.reject({type:"unauthorized"})).then(()=>{this.authState.set("authorized")},e=>{throw e&&"unauthorized"===e.type?this.authState.set("unauthorized"):(console.error(e),this.authState.set("error")),this.syncState.set("idle"),e})},checkSync(){return this.prepare().then(()=>this.startSync())},user:s.t,acquireLock:s.t,releaseLock:s.t,handleMetaError(e){throw e},getMeta(){return this.get({name:this.metaFile}).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>({name:this.metaFile,data:e}))},initToken(){this.prepareHeaders();const e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){const{progress:t}=this;let{delay:r}=e;null==r&&(r=this.delayTime);let o=Promise.resolve();return r&&(o=this.lastFetch.then(e=>Object(s.s)(r-(Date.now()-e))).then(()=>Date.now()),this.lastFetch=o),t.total+=1,$e(),o.then(()=>{let{prefix:t}=e;null==t&&(t=this.urlPrefix);const r=Object.assign({},this.headers,e.headers);let{url:o}=e;return o.startsWith("/")&&(o=t+o),Object(s.v)(o,{headers:r,method:e.method,body:e.body,responseType:e.responseType})}).then(({data:e})=>({data:e}),e=>({error:e})).then(({data:e,error:r})=>(t.finished+=1,$e(),r?Promise.reject(r):e))},getLocalData:()=>fe.list(),getSyncData(){return this.getMeta().then(e=>Promise.all([e,this.list(),this.getLocalData()]))},sync(){return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(()=>this.getSyncData()).then(e=>Promise.resolve(this.acquireLock()).then(()=>e)).then(([e,t,r])=>{const o=e.data||{},n=o.info||{},a=o.timestamp||0;let c=!a||Object.keys(n).length!==t.length;const l=Date.now(),u=j("lastModified"),d={},p=this.config.get("meta",{}),h=!p.timestamp,f=h||a>p.timestamp;this.log("First sync:",h),this.log("Outdated:",f,"(","local:",p.timestamp,"remote:",a,")");const m=[],g=[],b=[],y=[],w=[];o.info=t.reduce((e,t)=>{d[t.uri]=t;let r=n[t.uri];return r||(r={},c=!0),e[t.uri]=r,r.modified||(r.modified=l,c=!0),e},{}),r.forEach(e=>{const{props:{uri:t,position:r,lastModified:s}}=e,n=o.info[t],i=d[t];n&&i?(h||!s||n.modified>s?m.push({local:e,remote:i,info:n}):(n.modified<s&&(g.push({local:e,remote:i}),n.modified=s,c=!0),n.position!==r&&(n.position&&u<=a?w.push({local:e,remote:i,info:n}):(n.position=r,c=!0))),delete d[t]):h||!f||s>a?g.push({local:e}):y.push({local:e})}),i.a.call(d,([e,t])=>{const r=o.info[e];f?m.push({remote:t,info:r}):b.push({remote:t})});const v=[...m.map(({remote:e,info:t})=>(this.log("Download script:",e.uri),this.get(e).then(e=>{const r=(e=>{const t={};try{const r=JSON.parse(e);t.code=r.code,2===r.version?(t.config=r.config,t.custom=r.custom,t.props=r.props):1===r.version&&r.more&&(t.custom=r.more.custom,t.config=Object(i.h)({enabled:r.more.enabled,shouldUpdate:r.more.update}),t.props=Object(i.h)({lastUpdated:r.more.lastUpdated}))}catch(r){t.code=e}return t})(e);if(!r.code)return;t.modified&&Object(i.i)(r,"props.lastModified",t.modified);const s=+t.position;return s&&(r.position=s),!j("syncScriptStatus")&&r.config&&delete r.config.enabled,fe.update(r)}))),...g.map(({local:e,remote:t})=>(this.log("Upload script:",e.props.uri),fe.get(e.props.id).then(r=>{const s=((e,t,r)=>{let s;return s={version:1,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}},Object.assign(s,r)})(e,0,{code:r});return o.info[e.props.uri]={modified:e.props.lastModified,position:e.props.position},c=!0,this.put(Object.assign({},t,{uri:e.props.uri,name:null}),JSON.stringify(s))}))),...b.map(({remote:e})=>(this.log("Remove remote script:",e.uri),delete o.info[e.uri],c=!0,this.remove(e))),...y.map(({local:e})=>(this.log("Remove local script:",e.props.uri),fe.remove(e.props.id))),...w.map(({local:e,info:t})=>{const r={};return t.position&&(r.props={position:t.position}),de(e.props.id,r)})];return v.push(Promise.all(v).then(()=>re()).then(e=>{if(e)return c=!0,fe.list().then(e=>{e.forEach(e=>{const t=o.info[e.props.uri];t&&(t.position=e.props.position)})})})),v.push(Promise.all(v).then(()=>{const t=[];return c&&(o.timestamp=Date.now(),t.push(this.put(e,JSON.stringify(o)))),p.timestamp=o.timestamp,p.lastSync=Date.now(),this.config.set("meta",p),Promise.all(t)})),Promise.all(v.map(e=>e.then(s.t,e=>e||!0))).then(e=>e.filter(Boolean)).then(e=>{if(e.length)throw e})}).then(()=>{this.syncState.set("idle"),this.log("Sync finished:",this.displayName)},e=>{this.syncState.set("error"),this.log("Failed syncing:",this.displayName),this.log(e)}).then(()=>Promise.resolve(this.releaseLock()).catch(s.t))}});function Ie(e){ge.push(e)}function _e(){return we.get("current")}function Ce(e){return be[e||_e()]}function Pe(){we||(we=(()=>{function e(e,t){const r=Object(s.u)(e);r.unshift("sync"),k(r,t)}return(()=>{let t=j("sync");t&&t.services||(t={services:{}},e([],t))})(),{get:(e,t)=>{const r=Object(s.u)(e);return r.unshift("sync"),j(r,t)},set:e}})(),ge.forEach(e=>{const t=new e,{name:r}=t;me.push(r),be[r]=t})),Re()}function Re(){const e=Ce();return e&&Promise.resolve((e=>{if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0})(e)).then(ye)}x(e=>{Object(i.f)(e,"sync.current")&&Pe()});const De="https://violentmonkey.github.io/auth_dropbox.html",Ee=/[\u007f-\uffff]/g,Le=e=>`\\u${(e.charCodeAt(0)+65536).toString(16).slice(1)}`;function Ae(e){return JSON.stringify(e).replace(Ee,Le)}function ze(e){return{name:e.name,size:e.size,uri:ke(e.name)}}Ie(Me.extend({name:"dropbox",displayName:"Dropbox",user(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"}).catch(e=>401===e.status?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e}))},handleMetaError(e){if(409!==e.status)throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(e=>e.entries.filter(e=>"file"===e[".tag"]&&Oe(e.name)).map(ze))},get(e){const t=je(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":Ae({path:`/${t}`})}})},put(e,t){const r=je(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":Ae({path:`/${r}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(ze)},remove(e){const t=je(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(ze)},authorize(){const e=`https://www.dropbox.com/oauth2/authorize?${S({response_type:"token",client_id:"f0q12zup2uys5w8",redirect_uri:De})}`;browser.tabs.create({url:e})},authorized(e){const t=e.split("&").reduce((e,t)=>{const[r,s]=t.split("=").map(decodeURIComponent);return e[r]=s,e},{});t.access_token&&this.config.set({uid:t.uid,token:t.access_token})},checkAuth(e){const t=`${De}#`;if(e.startsWith(t))return this.authorized(e.slice(t.length)),this.checkSync(),!0},revoke(){return this.config.set({uid:null,token:null}),this.prepare()}}));const Ne=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0Ijoiajl4M09WRXRIdmhpSEtEV09HcXV5TWZaS2s5NjA0MEgifQ==")),qe=Object.assign({client_id:"000000004418358A",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"},Ne);function Ve(e){return{name:e.name,size:e.size,uri:ke(e.name)}}Ie(Me.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){const e=this.config.get("refresh_token");return this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare())},user(){const e=()=>this.loadData({url:"/drive",responseType:"json"});return e().catch(t=>{if(401===t.status)return this.refreshToken().then(e);throw t}).catch(e=>400===e.status&&"invalid_grant"===Object(i.f)(e,"data.error")?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e}))},handleMetaError(e){if(404===e.status){const t=e.xhr.getResponseHeader("WWW-Authenticate")||"";return/^Bearer realm="OneDriveAPI"/.test(t)?this.refreshToken().then(()=>this.getMeta()):void 0}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(e=>e.value.filter(e=>e.file&&Oe(e.name)).map(Ve))},get(e){const t=je(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(t)}`,responseType:"json"}).then(e=>this.loadData({url:e["@content.downloadUrl"],delay:!1}))},put(e,t){const r=je(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(r)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(Ve)},remove(e){const t=je(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(s.t)},authorize(){const e=`https://login.live.com/oauth20_authorize.srf?${S({client_id:qe.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:qe.redirect_uri})}`;browser.tabs.create({url:e})},checkAuth(e){const t=`${qe.redirect_uri}?code=`;if(e.startsWith(t))return this.authState.set("authorizing"),this.authorized({code:e.slice(t.length)}).then(()=>this.checkSync()),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S(Object.assign({},{client_id:qe.client_id,client_secret:qe.client_secret,redirect_uri:qe.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;this.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})})}}));const He=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0IjoiTjBEbTZJOEV3bkJaeE1xMUpuMHN3UER0In0=")),Be=Object.assign({client_id:"590447512361-05hjbhnf8ua3iha55e5pgqg15om0cpef.apps.googleusercontent.com",redirect_uri:"https://violentmonkey.github.io/auth_googledrive.html",scope:"https://www.googleapis.com/auth/drive.appdata"},He),Fe={status:"UNAUTHORIZED"};function Ge(e){return{id:e.id,name:e.name,size:+e.size,uri:ke(e.name)}}Ie(Me.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){const e=this.config.get("refresh_token");return e?this.authorized({refresh_token:e,grant_type:"refresh_token"}).then(()=>this.prepare()):Promise.reject({type:"unauthorized"})},user(){const e=()=>this.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${S({access_token:this.config.get("token")})}`,responseType:"json"});return e().then(e=>"online"===e.access_type?this.loadData({method:"POST",url:`https://accounts.google.com/o/oauth2/revoke?token=${this.config.get("token")}`,prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(()=>(l({title:"Sync Upgraded",body:"Please reauthorize access to your Google Drive to complete the upgradation."}),Promise.reject("Online access revoked."))):e.scope!==Be.scope?Promise.reject(Fe):void 0).catch(t=>t===Fe||400===t.status&&"Invalid Value"===Object(i.f)(t,"data.error_description")?this.refreshToken().then(e):Promise.reject({type:"error",data:t}))},getSyncData(){return this.loadData({url:`/files?${S({spaces:"appDataFolder",fields:"files(id,name,size)"})}`,responseType:"json"}).then(({files:e})=>{let t;const r=e.filter(e=>!!Oe(e.name)||(t||e.name!==this.metaFile?this.remove(e):t=e,!1)).map(Ge).filter(e=>!!e.size||(this.remove(e),!1)),s=t?Ge(t):{},o=this.get(s).then(e=>JSON.parse(e)).catch(e=>this.handleMetaError(e)).then(e=>Object.assign({},s,{name:this.metaFile,uri:null,data:e}));return Promise.all([o,r,this.getLocalData()])})},authorize(){const e={response_type:"code",access_type:"offline",client_id:Be.client_id,redirect_uri:Be.redirect_uri,scope:Be.scope};this.config.get("refresh_token")||(e.prompt="consent");const t=`https://accounts.google.com/o/oauth2/v2/auth?${S(e)}`;browser.tabs.create({url:t})},checkAuth(e){const t=`${Be.redirect_uri}?code=`;if(e.startsWith(t))return this.authState.set("authorizing"),this.authorized({code:decodeURIComponent(e.split("#")[0].slice(t.length))}).then(()=>this.checkSync()),!0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S(Object.assign({},{client_id:Be.client_id,client_secret:Be.client_secret,redirect_uri:Be.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(e=>{if(!e.access_token)throw e;{const t={token:e.access_token};e.refresh_token&&(t.refresh_token=e.refresh_token),this.config.set(t)}})},handleMetaError:s.t,list(){throw new Error("Not supported")},get({id:e}){return e?this.loadData({url:`/files/${e}?alt=media`}):Promise.reject()},put(e,t){const r=je(e),{id:o}=e,n=Object(s.m)("violentmonkey-is-great-"),i={"Content-Type":`multipart/related; boundary=${n}`},a=o?{name:r}:{name:r,parents:["appDataFolder"]},c=[`--${n}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(a),`--${n}`,"Content-Type: text/plain","",t,`--${n}--`,""].join("\r\n"),l=o?`https://www.googleapis.com/upload/drive/v3/files/${o}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:l,body:c,headers:i,method:o?"PATCH":"POST"})},remove({id:e}){return this.loadData({method:"DELETE",url:`/files/${e}`})}}));const We=Symbol("children");class Je{constructor(e,t){this.node=e,this.nsMap=T()({},t),this.parseAttrs(),this.parseName()}static fromXML(e){const t=(new DOMParser).parseFromString(e,"application/xml");return new Je(t)}parseAttrs(){const{node:e,nsMap:t}=this,r={},{attributes:s}=e;if(s)for(const s of e.attributes){const{name:e,value:o}=s;"xmlns"===e?t.$=o:e.startsWith("xmlns:")&&(t[e.slice(6)]=o),r[e]=o}this.attrs=r}parseName(){const{node:e,nsMap:t}=this;if(1===e.nodeType){let r=e.tagName,s=t.$;if(r.includes(":")){let e;if([e,r]=r.split(":"),s=t[e],!s)throw new Error(`Unknown namespace: ${e}`)}this.name=s+r}}text(){const{node:e}=this;if(e)return(e.textContent||"").trim()}children(){if(!this[We]){const{node:e,nsMap:t}=this;this[We]=[...e.children].map(e=>new Je(e,t))}return this[We]}map(e){return this.children().map(e)}getCallback(e){return"string"==typeof e?(t=e,e=>e.name===t):e;var t}filter(e){return this.children().filter(this.getCallback(e))}find(e){return this.children().find(this.getCallback(e))}attr(e){return this.attrs[e]}}const Xe={serverUrl:"",anonymous:!1,username:"",password:""};Ie(Me.extend({name:"webdav",displayName:"WebDAV",properties:{authType:"password",serverUrl:null},getUserConfig(){return this.userConfig||(this.userConfig=T()({},Xe,{},this.config.get("userConfig"))),this.userConfig},setUserConfig(e){Object.assign(this.userConfig,e),this.config.set("userConfig",this.userConfig)},initToken(){var e;this.prepareHeaders();const t=this.getUserConfig();let r=(null==(e=t.serverUrl)?void 0:e.trim())||"";r.includes("://")||(r=`http://${r}`),r.endsWith("/")||(r+="/");try{new URL(r)}catch(e){return this.properties.serverUrl=null,!1}this.properties.serverUrl=`${r}Violentmonkey/`;const{anonymous:s,username:o,password:n}=t;if(s)return!0;if(!o||!n)return!1;const i=window.btoa(`${o}:${n}`);return this.headers.Authorization=`Basic ${i}`,!0},handleMetaError(e){if(![404,409].includes(e.status))throw e},list(){const{serverUrl:e}=this.properties,t=()=>this.loadData({method:"MKCOL",url:e}),r=()=>this.loadData({method:"PROPFIND",url:e,headers:{depth:"1"}}).then(e=>Je.fromXML(e).children()[0].map(e=>{const t=e.find("DAV:propstat").find("DAV:prop");if("file"==(t.find("DAV:resourcetype").find("DAV:collection")?"directory":"file")){let s;const o=t.find("DAV:displayname");if(void 0!==o)s=o.text();else{const t=e.find("DAV:href").text();s=decodeURIComponent(t.substring(t.lastIndexOf("/")+1))}if(Oe(s)){const e=t.find("DAV:getcontentlength");return{name:(r={name:s,size:e?+e.text():0}).name,size:r.size,uri:ke(r.name)}}}var r;return null}).filter(Boolean));return r().catch(e=>{if(404===e.status)return t().then(r);throw e})},get(e){const t=je(e),{serverUrl:r}=this.properties;return this.loadData({url:r+t})},put(e,t){const r=je(e),s={"Content-Type":"text/plain"},o=this.config.get("lock");o&&(s.If=`(<${o}>)`);const{serverUrl:n}=this.properties;return this.loadData({method:"PUT",url:n+r,body:t,headers:s})},remove(e){const t=je(e),r={},s=this.config.get("lock");s&&(r.If=`(<${s}>)`);const{serverUrl:o}=this.properties;return this.loadData({method:"DELETE",url:o+t,headers:r})}})),Object.assign(c,{SyncAuthorize:()=>{const e=Ce();e&&e.authorize()},SyncRevoke:()=>{const e=Ce();e&&e.revoke()},SyncStart:Re,SyncSetConfig:e=>{const t=Ce();if(t)return t.setUserConfig(e),t.checkSync()}}),browser.tabs.onUpdated.addListener((e,t)=>{var r;t.url&&(r=t.url,me.some(e=>{const t=be[e];return t.checkAuth&&t.checkAuth(r)}))&&browser.tabs.remove(e)});const Ze=["setIcon","setBadgeText","setBadgeBackgroundColor","setTitle"].reduce((e,t)=>{const r=browser.browserAction[t];return e[t]=r?r.bind(browser.browserAction):s.t,e},{}),Ke={};let Qe,Ye,et,tt;const rt=n.a.isChrome&&{};function st(e,t=Ke[e.id]){t&&Ze.setBadgeText({text:`${t[Ye]||""}`,tabId:e.id})}function ot(e,t=e.pendingUrl||e.url){const r=e.id,s=o.c.test(t),n=(s?Z(t):void 0)&&et||!s&&tt||"";if(n||(Ke[r]||{}).blocked){Ze.setTitle({title:n,tabId:r});const t=n?{blocked:!0}:{};Ke[r]=t,nt(e,t),st(e,t)}}async function nt(e={},t={}){const r=(t.blocked?"b":!Qe&&"w")||"",s={};for(const e of[16,19,32,38]){const t=`/public/images/icon${e}${r}.png`;let o=rt?rt[t]:t;o||(o=await it(t),rt[t]=o),s[e]=o}Ze.setIcon({tabId:e.id,[rt?"imageData":"path"]:s})}function it(e){return new Promise(t=>{const r=new Image;r.src=e,r.onload=()=>{const{width:e,height:s}=r,o=document.createElement("canvas"),n=o.getContext("2d");o.width=e,o.height=s,n.clearRect(0,0,e,s),n.drawImage(r,0,0,e,s),t(n.getImageData(0,0,e,s))}})}x(e=>{"isApplied"in e&&(Qe=e.isApplied,nt(),u(nt)),"showBadge"in e&&(Ye=e.showBadge,u(st)),"blacklist"in e&&u(ot)}),m.push(()=>{Qe=j("isApplied"),Ye=j("showBadge"),et=Object(s.n)("failureReasonBlacklisted"),tt=Object(s.n)("failureReasonNoninjectable"),u(ot)}),browser.tabs.onRemoved.addListener(e=>{delete Ke[e]}),browser.tabs.onUpdated.addListener((e,t,r)=>{("loading"===t.status||t.favIconUrl&&r.url.startsWith("about:"))&&ot(r,t.url)});const at={urls:["*://*/*"],types:["main_frame","sub_frame"]};function ct(e,t){return`preinject${+t}:${e}`}function lt(e){const t=`${e?"add":"remove"}Listener`,r=e?at:void 0;browser.webRequest.onSendHeaders[t](ut,r),browser.webRequest.onHeadersReceived[t](dt,r)}function ut({url:e,frameId:t}){const r=!t,s=ct(e,r);p.has(s)||p.put(s,le(e,r),1e3)}function dt({url:e,frameId:t}){p.hit(ct(e,!t),250)}function pt(e={}){const t=O("scriptTemplate");let r=e.scriptTemplate;r||(r=t,e.scriptTemplate=r,k("scriptTemplate",r));const s=r!==t;s!==e.scriptTemplateEdited&&(e.scriptTemplateEdited=s,k("scriptTemplateEdited",s))}m.push(()=>{let e=j("scriptTemplateEdited");if(e)return;const t=j("scriptTemplate");null==e?(e="// ==UserScript==\n// @name New Script\n// @namespace Violentmonkey Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n"!==t,e?k("scriptTemplateEdited",!0):pt()):t!==O("scriptTemplate")&&pt()});const ht={};let ft,mt={};function gt(e){i.a.call(ht,([t,r])=>{e in r&&(delete r[e],Object(s.p)(r)&&delete ht[t])})}async function bt(e){const t=Object.keys(e),r=await ie(t);t.forEach(t=>{var s;(s=e[t],i.a).call(s,([e,{last:s}])=>{Object(i.i)(r,[t,e],s||void 0)})}),await Promise.all([ae(r),yt(wt(e),{partial:!0})])}async function yt(e,{partial:t}={}){const r=[];for(const[o,n]of Object.entries(e))for(const[e,i]of Object.entries(n))Object(s.p)(i)||(t&&(i.partial=!0),r.push(Object(s.x)(+o,"UpdatedValues",i,{frameId:+e})),20===r.length&&await Promise.all(r.splice(0)));await Promise.all(r)}function wt(e){const t={};return i.a.call(e,([e,r])=>{var s;const o=Object.entries(r);(s=ht[e],i.a).call(s,([r,s])=>{i.b.call(s,s=>{o.forEach(([o,n])=>{var a;n.last!==(null==(a=n[r])?void 0:a[s])&&Object(i.i)(t,[r,s,e,o],n.last)})})})}),t}function vt(e){const t={};return i.a.call(e,([e,r])=>{var s;(s=ht[e],i.a).call(s,([s,o])=>{i.b.call(o,o=>{Object(i.i)(t,[s,o,e],r)})})}),t}Object.assign(c,{GetValueStore:async e=>(await ie([e]))[e]||{},async SetValueStores(e){const t=e.reduce((e,{where:t,store:r})=>{var s;const o=t.id||(null==(s=oe(t))?void 0:s.props.id);return o&&(e[o]=r),e},{});await Promise.all([ae(t),yt(vt(t))])},UpdateValue({id:e,key:t,value:r=null},o){Object(i.i)(mt,[e,t,"last"],r),Object(i.i)(mt,[e,t,o.tab.id,o.frameId],r),(async()=>{for(;!ft;){ft=!0,await 0;const e=mt;if(mt={},await bt(e),ft=!1,Object(s.p)(mt))break}})()}}),browser.tabs.onRemoved.addListener(gt),browser.tabs.onReplaced.addListener((e,t)=>gt(t));const jt=document.createElement("textarea");let Ot;Object.assign(c,{SetClipboard(e){Ot=e,jt.focus(),document.execCommand("copy",!1,null)}}),document.body.appendChild(jt),document.addEventListener("copy",e=>{e.preventDefault();const{type:t,data:r}=Ot;e.clipboardData.setData(t||"text/plain",r)});const kt={newScript:"#scripts/_new",settings:"#settings"};m.push(()=>{browser.commands.onCommand.addListener(async e=>{const t=await Object(s.i)(),r=`${browser.runtime.getURL(browser.runtime.getManifest().options_ui.page)}${kt[e]||""}`;c.TabOpen({url:r,insert:!0},{tab:t})})});const xt={};Object.assign(c,{async Notification(e,t){const r=t.tab||{},o=await browser.notifications.create({type:"basic",title:e.title||Object(s.n)("extName"),message:e.text,iconUrl:e.image||s.e});return xt[o]=r.id,o}}),browser.notifications.onClicked.addListener(e=>{const t=xt[e];t>=0&&Object(s.x)(t,"NotificationClick",e)}),browser.notifications.onClosed.addListener(e=>{const t=xt[e];t>=0&&(Object(s.x)(t,"NotificationClose",e),delete xt[e])});const St={},Ut={};Object.assign(c,{ConfirmInstall:Ct,GetRequestId(e=[]){const t=Object(s.m)();return St[t]={id:t,eventsToNotify:e,xhr:new XMLHttpRequest},t},HttpRequest(e,t){const{tab:r,frameId:o}=t;(async(e,t,r)=>{const{anonymous:s,data:o,headers:a,id:c,isBuffer:l,method:u,overrideMimeType:d,password:p,timeout:h,url:f,user:m}=e,g=St[c];if(!g||g.cb)return;g.cb=r,g.anonymous=s,g.isBuffer=l;const{xhr:b}=g;try{const e=[];let r=n.a.isFirefox&&!s;if(b.open(u,f,!0,m||"",p||""),b.setRequestHeader("VM-Verify",c),a&&i.a.call(a,([t,s])=>{const o=t.toLowerCase();var n;n=o,Tt.includes(n)||n.startsWith("proxy-")||n.startsWith("sec-")?e.push({name:t,value:s}):o.startsWith("vm-")||b.setRequestHeader(t,s),"cookie"===o&&(r=!1)}),h&&(b.timeout=h),l&&(b.responseType="arraybuffer"),d&&b.overrideMimeType(d),r){const r=await browser.cookies.getAll(T()({url:f,storeId:t.tab.cookieStoreId},n.a.isFirefox>=59&&{firstPartyDomain:null}));r.length&&(g.noNativeCookie=!0,e.push({name:"cookie",value:r.map(e=>`${e.name}=${e.value};`).join(" ")}))}const y=(e=>{let t,r,s,o=Promise.resolve();const{id:n,isBuffer:a,xhr:c}=e,l=t=>{o=o.then(()=>e.cb(t))};return o=>{if("loadend"===o.type&&_t(e),!e.cb)return;const{response:u}=c;a&&u&&!s&&(s=Math.ceil(u.byteLength/64e6)||1),l({id:n,numChunks:s,contentType:r||(r=c.getResponseHeader("Content-Type")||"application/octet-stream"),data:e.eventsToNotify.includes(o.type)?T()({finalUrl:c.responseURL,readyState:c.readyState,responseHeaders:e.responseHeaders||c.getAllResponseHeaders(),status:c.status,statusText:c.statusText,response:s&&!t?Mt(u,0):u,responseText:It(c)},"loaded"in o&&Object(i.g)(o,["lengthComputable","loaded","total"])):{},type:o.type});for(let e=1;e<s;e+=1)l({id:n,chunk:Mt(u,e),isLastChunk:e===s-1});t=!!s}})(g);g.eventsToNotify.forEach(e=>{b[`on${e}`]=y}),b.onloadend=y;const w=o?function e(t){const{cls:r,value:s}=t;if("formdata"===r){const t=new FormData;return s&&i.a.call(s,([r,s])=>{s.forEach(s=>{t.append(r,e(s))})}),t}if(["blob","file"].includes(r)){const{type:e,name:o,lastModified:n}=t,i=new Uint8Array(s.length);for(let e=0;e<s.length;e+=1)i[e]=s.charCodeAt(e);const a=[i.buffer];return"file"===r?new File(a,o,{type:e,lastModified:n}):new Blob(a,{type:e})}if(s)return JSON.parse(s)}(o):null;$t.add(c,e),b.send(w)}catch(e){const{scriptId:t}=g;console.warn(e,`in script id ${t}, ${se(t).meta.name}`)}})(e,t,e=>Object(s.x)(r.id,"HttpRequested",e,{frameId:o}))},AbortRequest(e){const t=St[e];t&&(t.xhr.abort(),_t(t))}});const Tt=["user-agent","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],$t=(()=>{const e={urls:["<all_urls>"],types:["xmlhttprequest"],tabId:-1},t=[browser.webRequest.OnBeforeSendHeadersOptions.EXTRA_HEADERS].filter(Boolean),r={},o=e=>"VM-Verify"===e.name,n=e=>!/^cookie2?$/i.test(e.name),a=e=>!/^set-cookie2?$/i.test(e.name),c=e=>"VM-Verify"!==e.name,l=e=>c(e)&&n(e),u={onBeforeSendHeaders:{options:["requestHeaders","blocking",...t],listener({requestHeaders:e,requestId:t}){var s;const i=(null==(s=e.find(o))?void 0:s.value)||Ut[t],a=i&&St[i];return i&&a&&(Ut[t]=i,a.coreId=t,e=(a.noNativeCookie?e.filter(n):e).concat(r[i]||[]).filter(a.anonymous?l:c)),{requestHeaders:e}}},onHeadersReceived:{options:["responseHeaders","blocking",...t],listener({responseHeaders:e,requestId:t}){const r=St[Ut[t]];if(r){const t=e.length;if(r.anonymous&&(e=e.filter(a)),r.responseHeaders=e.map(({name:e,value:t})=>`${e}: ${t}\r\n`).sort().join(""),e.length<t)return{responseHeaders:e}}}}};return{add(t,s){r[t]=s,i.a.call(u,([t,{listener:r,options:s}])=>{browser.webRequest[t].addListener(r,e,s)})},del(e){e in r&&(delete r[e],Object(s.p)(r)&&i.a.call(u,([e,{listener:t}])=>{browser.webRequest[e].removeListener(t)}))}}})();function Mt(e,t){return Object(s.a)(e,64e6*t,64e6)}function It(e){try{return e.responseText}catch(e){}}function _t(e){e.coreId&&delete Ut[e.coreId],delete St[e.id],$t.del(e.id)}async function Ct(e,t={}){const{url:r,from:o}=e,i=e.code||(await Object(s.v)(r)).data;if(/^\s*</.test(a=i)||a.indexOf("// ==UserScript==")<0)throw Object(s.n)("msgInvalidScript");var a;p.put(r,i,3e3);const c=Object(s.m)();p.put(`confirm-${c}`,{url:r,from:o}),browser.tabs.create(T()({url:`/confirm/index.html#${c}`,index:t.tab?t.tab.index+1:void 0},t.tab&&n.a.openerTabIdSupported?{openerTabId:t.tab.id}:{}))}const Pt=["^https://greasyfork.org/scripts/[^/]*/code/[^/]*?\\.user\\.js([?#]|$)","^https://openuserjs.org/install/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://github.com/[^/]*/[^/]*/raw/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://gist.github.com/.*?/[^/]*?.user.js([?#]|$)"].map(e=>new RegExp(e)),Rt=["//(?:(?:gist.|)github.com|greasyfork.org|openuserjs.org)/"].map(e=>new RegExp(e)),Dt={},Et=browser.runtime.getURL("/");browser.tabs.onCreated.addListener(e=>{/\.user\.js([?#]|$)/.test(e.pendingUrl||e.url)&&p.put(`autoclose:${e.id}`,!0,1e3)}),browser.webRequest.onBeforeRequest.addListener(e=>{const{url:t}=e;if("GET"===e.method){if(t.startsWith(Et)){const e=+t.split("#").pop();return{redirectUrl:`${Et}options/index.html#scripts/${e}`}}if(!Dt[t]&&(Pt.some(e=>e.test(t))||!Rt.some(e=>e.test(t))))return Promise.all([Object(s.v)(t).catch(()=>({data:""})),e.tabId<0?Promise.resolve():browser.tabs.get(e.tabId)]).then(([{data:r},s])=>{P(r).name?(Ct({code:r,url:t,from:s&&(s.pendingUrl||s.url)},{tab:s}),p.has(`autoclose:${e.tabId}`)&&browser.tabs.remove(e.tabId)):(Dt[t]||(Dt[t]={timer:setTimeout(()=>{delete Dt[t]},1e4)}),s&&s.id&&browser.tabs.update(s.id,{url:t}))}),{redirectUrl:"javascript:history.back()"}}},{urls:["*://*/*.user.js","*://*/*.user.js?*","file://*/*.user.js","file://*/*.user.js?*",`${Et}*.user.js`],types:["main_frame"]},["blocking"]);const Lt={};Object.assign(c,{async TabOpen({url:e,active:t,container:r,insert:o=!0,pinned:i},a={}){const c=a.tab||await Object(s.i)()||{},l=!a.url||a.url.startsWith(window.location.protocol),u=c.cookieStoreId,{id:d}=await browser.tabs.create(T()({active:!1!==t,pinned:!!i,url:l?e:Object(s.j)(e,a.url),windowId:c.windowId},u&&{cookieStoreId:(p=l?0:r,(0===p?"firefox-default":p>0&&`firefox-container-${p}`)||u)},{},o&&{index:c.index+1},{},n.a.openerTabIdSupported&&{openerTabId:c.id}));var p;return Lt[d]=c.id,{id:d}},TabClose({id:e}={},t){var r;const s=e||(null==t?void 0:null==(r=t.tab)?void 0:r.id);s>=0&&browser.tabs.remove(s)}}),n.a.ready.then(()=>{Object.defineProperties(n.a,{openerTabIdSupported:{value:n.a.isChrome||n.a.isFirefox>=57&&"android"!==n.a.os}})}),browser.tabs.onRemoved.addListener(e=>{const t=Lt[e];t>=0&&(Object(s.x)(t,"TabClosed",e),delete Lt[e])}),Object.assign(c,{CheckUpdate:e=>qt(se(e)),async CheckUpdateAll(){k("lastUpdate",Date.now());const e=ne().filter(e=>e.config.shouldUpdate);return(await Promise.all(e.map(qt))).includes(!0)}});const At={},zt={"Cache-Control":"no-cache, no-store, must-revalidate"},Nt={meta:{headers:T()({},zt,{Accept:"text/x-userscript-meta"})},script:{headers:zt}};function qt(e){const{id:t}=e.props;return At[t]||(At[t]=(async e=>{const{id:t}=e.props;try{const{update:r}=await pe({id:t,code:await Vt(e),update:{checking:!1}});return(e=>{var t;const r=j("notifyUpdates");return j("notifyUpdatesGlobal")?r:null!=(t=e.config.notifyUpdates)?t:r})(e)&&l({title:Object(s.n)("titleScriptUpdated"),body:Object(s.n)("msgScriptUpdated",[r.meta.name||Object(s.n)("labelNoName")])}),!0}catch(e){}finally{delete At[t]}})(e))}async function Vt(e){const t=e.custom.downloadURL||e.meta.downloadURL||e.custom.lastInstallURL,r=e.custom.updateURL||e.meta.updateURL||t;if(!r)throw!1;let n=!0;const i={},a={update:i,where:{id:e.props.id}};c(Object(s.n)("msgCheckingForUpdate"));try{const{data:o}=await Object(s.v)(r,Nt.meta),i=P(o);if(Object(s.c)(e.meta.version,i.version)>=0)c(Object(s.n)("msgNoUpdate"),{checking:!1});else{if(t)return c(Object(s.n)("msgUpdating")),n=!1,(await Object(s.v)(t,Nt.script)).data;c(Object(s.n)("msgNewVersion"),{checking:!1})}}catch(e){c(n?Object(s.n)("msgErrorFetchingUpdateInfo"):Object(s.n)("msgErrorFetchingScript"),{error:e})}throw i.error;function c(e,{error:t,checking:r=!t}={}){Object.assign(i,{message:e,checking:r,error:(null==t?void 0:t.url)||t||null}),Object(s.w)(o.b,a)}}const Ht=browser.runtime.getManifest().version,Bt={};let Ft,Gt;x(e=>{"autoUpdate"in e&&Zt(),"defaultInjectInto"in e&&(Gt=e.defaultInjectInto),"isApplied"in e&&(Ft=e.isApplied,lt(Ft)),"scriptTemplate"in e&&pt(e),Object(s.w)("UpdateOptions",e)}),Object.assign(c,{async GetData(){const e=await(async()=>({scripts:Q.scripts,cache:await $.a.cache.getMulti(Q.scripts.reduce((e,t)=>{const{icon:r}=t.meta;var o;return Object(s.q)(r)&&e.push((null==(o=t.custom.pathMap)?void 0:o[r])||r),e},[]))}))();return e.sync=Se(),e.version=Ht,e},async GetInjected(e,t){const{frameId:r,tab:s,url:o}=t,a=!r;a&&gt(s.id);const c={isApplied:Ft,injectInto:Gt,ua:n.a,isFirefox:n.a.isFirefox,isPopupShown:Bt[s.id],version:Ht};if(Ft){const e=ct(o,a),n=await(p.get(e)||le(o,a));((e,t,r)=>{r.forEach(r=>{Object(i.i)(ht,[r,e,t],1)})})(s.id,r,n.withValueIds),((e,{tab:t,frameId:r})=>{const s=t.id,o=Ke[s]||{};o.idMap&&0!==r||(o.total=0,o.unique=0,o.idMap={},Ke[s]=o),o.total+=e.length,e&&(e.forEach(e=>{o.idMap[e]=1}),o.unique=Object.keys(o.idMap).length),Ze.setBadgeBackgroundColor({color:o.blocked?"#888":"#808",tabId:s}),st(t,o)})(n.enabledIds,t),Object.assign(c,n)}return c}});const Wt=["MarkRemoved","Move","ParseScript","RemoveScript","UpdateScriptInfo"],Jt=["CheckRemove","CheckUpdate","CheckUpdateAll"];async function Xt(e,t){const{cmd:r}=e,s=await(null==c[r]?void 0:c[r](e.data,t));return(Wt.includes(r)||s&&Jt.includes(r))&&Re(),null!=s?s:null}function Zt(){const e=(+j("autoUpdate")||0)*o.h;if(!e)return;let t=Date.now()-j("lastUpdate");t>=e&&(Xt({cmd:"CheckUpdateAll"}),t=0),clearTimeout(Zt.timer),Zt.timer=setTimeout(Zt,Math.min(o.j,e-t))}function Kt(e){const t=+e.name;Bt[t]=1,Object(s.x)(t,"PopupShown",!0),e.onDisconnect.addListener(Qt)}function Qt({name:e}){delete Bt[e],Object(s.x)(+e,"PopupShown",!1)}(async e=>{const t=e=>"function"==typeof e?e():e;await Promise.all(f.map(t)),await t(()=>{browser.runtime.onMessage.addListener(Xt),browser.runtime.onConnect.addListener(Kt),Gt=j("defaultInjectInto"),Ft=j("isApplied"),lt(Ft),setTimeout(Zt,2e4),Pe(),ue(),setInterval(ue,o.h)}),await Promise.all(m.map(t)),f.length=0,m.length=0})()}});